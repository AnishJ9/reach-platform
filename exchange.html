<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REACH Exchange - Fellow Survey System</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:opsz,wght@8..60,400;8..60,600&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-cream: #FAF8F5;
            --color-warm-white: #FFFEFB;
            --color-sand: #F0EBE3;
            --color-stone: #E8E2D9;
            --color-text: #2D2A26;
            --color-text-secondary: #5C5752;
            --color-text-muted: #8A857D;
            --color-teal: #2A7C7C;
            --color-teal-dark: #1E5F5F;
            --color-teal-light: #E8F4F4;
            --color-terracotta: #C4724E;
            --color-terracotta-light: #FAF0EC;
            --color-success: #059669;
            --color-warning: #D97706;
            
            --font-serif: 'Source Serif 4', Georgia, serif;
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            
            --space-xs: 0.5rem;
            --space-sm: 1rem;
            --space-md: 1.5rem;
            --space-lg: 2rem;
            --space-xl: 3rem;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* Login Screen */
        .login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--color-teal) 0%, var(--color-teal-dark) 100%);
            padding: var(--space-md);
        }
        
        .login-screen.hidden {
            display: none;
        }
        
        /* Landing Screen */
        .landing-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--color-cream) 0%, var(--color-sand) 100%);
            padding: var(--space-md);
        }
        
        .landing-screen.hidden {
            display: none;
        }
        
        .landing-container {
            max-width: 900px;
            width: 100%;
        }
        
        .landing-header {
            text-align: center;
            margin-bottom: var(--space-xl);
        }
        
        .landing-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-sm);
        }
        
        .landing-logo .logo-mark {
            width: 56px;
            height: 56px;
            background: var(--color-teal);
            color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-serif);
            font-size: 1.75rem;
            font-weight: 600;
        }
        
        .landing-logo .logo-text {
            font-family: var(--font-serif);
            font-size: 2rem;
            font-weight: 600;
            color: var(--color-text);
        }
        
        .landing-tagline {
            font-size: 1.1rem;
            color: var(--color-text-secondary);
        }
        
        .landing-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-lg);
        }
        
        .landing-cards-three {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: var(--space-lg);
        }
        
        @media (max-width: 900px) {
            .landing-cards-three {
                grid-template-columns: 1fr 1fr;
            }
            .landing-card--admin {
                grid-column: 1 / -1;
                max-width: 400px;
                margin: 0 auto;
            }
        }
        
        @media (max-width: 600px) {
            .landing-cards-three {
                grid-template-columns: 1fr;
            }
            .landing-card--admin {
                max-width: none;
            }
        }
        
        @media (max-width: 700px) {
            .landing-cards {
                grid-template-columns: 1fr;
            }
        }
        
        .landing-card {
            background: white;
            border-radius: 16px;
            padding: var(--space-lg);
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            text-align: center;
        }
        
        .landing-card--sponsor {
            border: 2px solid var(--color-teal);
        }
        
        .landing-card--fellow {
            border: 2px solid var(--color-terracotta);
        }
        
        .landing-card--admin {
            border: 1px solid var(--color-stone);
        }
        
        .landing-card-icon {
            font-size: 3rem;
            margin-bottom: var(--space-sm);
        }
        
        .landing-card h2 {
            font-family: var(--font-serif);
            font-size: 1.5rem;
            margin-bottom: var(--space-xs);
        }
        
        .landing-card > p {
            color: var(--color-text-secondary);
            font-size: 0.95rem;
            margin-bottom: var(--space-md);
        }
        
        .landing-benefits {
            text-align: left;
            margin-bottom: var(--space-md);
            padding-left: var(--space-md);
        }
        
        .landing-benefits li {
            color: var(--color-text-secondary);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            position: relative;
        }
        
        .landing-benefits li::marker {
            color: var(--color-teal);
        }
        
        .landing-card-note {
            font-size: 0.8rem;
            color: var(--color-text-muted);
            margin-top: var(--space-sm);
        }
        
        .landing-footer {
            text-align: center;
            margin-top: var(--space-xl);
            font-size: 0.85rem;
            color: var(--color-text-muted);
        }
        
        .landing-footer a {
            color: var(--color-teal);
            text-decoration: none;
        }
        
        .landing-footer a:hover {
            text-decoration: underline;
        }
        
        .btn--large {
            padding: 1rem 2rem;
            font-size: 1rem;
        }
        
        /* Sponsor Portal */
        .sponsor-portal {
            min-height: 100vh;
            background: var(--color-cream);
        }
        
        .sponsor-portal.hidden {
            display: none;
        }
        
        .sponsor-portal-header {
            background: white;
            border-bottom: 1px solid var(--color-stone);
            padding: var(--space-md) var(--space-lg);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .sponsor-portal-nav {
            max-width: 1000px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        
        .sponsor-portal-nav .landing-logo {
            margin: 0;
        }
        
        .sponsor-portal-nav .landing-logo .logo-mark {
            width: 40px;
            height: 40px;
            font-size: 1.25rem;
        }
        
        .sponsor-portal-nav .landing-logo .logo-text {
            font-size: 1.25rem;
        }
        
        .back-link {
            color: var(--color-text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
        }
        
        .back-link:hover {
            color: var(--color-teal);
        }
        
        .portal-badge {
            background: var(--color-teal-light);
            color: var(--color-teal);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-left: auto;
        }
        
        .sponsor-portal-content {
            max-width: 1000px;
            margin: 0 auto;
            padding: var(--space-xl) var(--space-lg);
        }
        
        .sponsor-portal-intro {
            text-align: center;
            margin-bottom: var(--space-xl);
        }
        
        .sponsor-portal-intro h1 {
            font-family: var(--font-serif);
            font-size: 2.5rem;
            margin-bottom: var(--space-sm);
            color: var(--color-text);
        }
        
        .intro-lead {
            font-size: 1.15rem;
            color: var(--color-text-secondary);
            max-width: 700px;
            margin: 0 auto var(--space-lg);
        }
        
        .value-props {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
            margin-top: var(--space-lg);
        }
        
        @media (max-width: 800px) {
            .value-props {
                grid-template-columns: 1fr;
            }
        }
        
        .value-prop {
            background: white;
            border-radius: 12px;
            padding: var(--space-md);
            text-align: left;
        }
        
        .value-prop-icon {
            font-size: 2rem;
            margin-bottom: var(--space-sm);
        }
        
        .value-prop h3 {
            font-family: var(--font-serif);
            font-size: 1.1rem;
            margin-bottom: var(--space-xs);
        }
        
        .value-prop p {
            font-size: 0.9rem;
            color: var(--color-text-secondary);
            line-height: 1.5;
        }
        
        .sponsor-portal-form-container {
            max-width: 700px;
            margin: 0 auto;
        }
        
        .sponsor-form-card {
            background: white;
            border-radius: 16px;
            padding: var(--space-xl);
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .sponsor-form-card h2 {
            font-family: var(--font-serif);
            font-size: 1.5rem;
            margin-bottom: var(--space-xs);
        }
        
        .sponsor-form-card .form-intro {
            color: var(--color-text-secondary);
            margin-bottom: var(--space-lg);
        }
        
        .sponsor-form-card .form-section-title {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--color-text);
            margin-top: var(--space-lg);
            margin-bottom: var(--space-sm);
            padding-bottom: var(--space-xs);
            border-bottom: 1px solid var(--color-stone);
        }
        
        .sponsor-form-card .form-section-title:first-of-type {
            margin-top: 0;
        }
        
        .sponsor-form-card .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-md);
        }
        
        @media (max-width: 500px) {
            .sponsor-form-card .form-row {
                grid-template-columns: 1fr;
            }
        }
        
        .sponsor-form-card .form-group {
            margin-bottom: var(--space-md);
        }
        
        .sponsor-form-card .form-group label {
            display: block;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--color-text-secondary);
            margin-bottom: 0.35rem;
        }
        
        .sponsor-form-card .form-group input,
        .sponsor-form-card .form-group select,
        .sponsor-form-card .form-group textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--color-stone);
            border-radius: 8px;
            font-family: var(--font-sans);
            font-size: 0.95rem;
        }
        
        .sponsor-form-card .form-group input:focus,
        .sponsor-form-card .form-group select:focus,
        .sponsor-form-card .form-group textarea:focus {
            outline: none;
            border-color: var(--color-teal);
        }
        
        .sponsor-form-card .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }
        
        .sponsor-form-card .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: var(--color-cream);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }
        
        .sponsor-form-card .checkbox-item:hover {
            background: var(--color-sand);
        }
        
        .sponsor-form-card .checkbox-item input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        
        .sponsor-form-card .form-actions {
            margin-top: var(--space-lg);
            padding-top: var(--space-lg);
            border-top: 1px solid var(--color-stone);
        }
        
        .sponsor-form-success {
            text-align: center;
            padding: var(--space-lg);
        }
        
        .sponsor-form-success.hidden {
            display: none;
        }
        
        .sponsor-form-success .success-icon {
            width: 80px;
            height: 80px;
            background: var(--color-teal);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin: 0 auto var(--space-md);
        }
        
        .sponsor-form-success h3 {
            font-family: var(--font-serif);
            font-size: 1.5rem;
            margin-bottom: var(--space-sm);
        }
        
        .sponsor-form-success > p {
            color: var(--color-text-secondary);
            margin-bottom: var(--space-md);
        }
        
        .sponsor-form-success .success-details {
            background: var(--color-cream);
            padding: var(--space-md);
            border-radius: 12px;
            text-align: left;
            margin-bottom: var(--space-lg);
        }
        
        .sponsor-form-success .success-details p {
            font-weight: 500;
            margin-bottom: var(--space-xs);
        }
        
        .sponsor-form-success .success-details ol {
            margin: 0;
            padding-left: var(--space-md);
            color: var(--color-text-secondary);
            font-size: 0.9rem;
        }
        
        .sponsor-form-success .success-details li {
            margin-bottom: 0.35rem;
        }
        
        .sponsor-portal-footer {
            text-align: center;
            padding: var(--space-lg);
            color: var(--color-text-muted);
            font-size: 0.85rem;
        }
        
        .sponsor-portal-footer a {
            color: var(--color-teal);
            text-decoration: none;
        }
        
        /* Fellow Portal */
        .fellow-portal {
            min-height: 100vh;
            background: var(--color-cream);
        }
        
        .fellow-portal.hidden {
            display: none;
        }
        
        .fellow-portal-header {
            background: var(--color-terracotta);
            color: white;
            padding: var(--space-md) var(--space-lg);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .fellow-portal-nav {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .fellow-portal-nav .landing-logo .logo-mark {
            background: white;
            color: var(--color-terracotta);
        }
        
        .fellow-portal-nav .landing-logo .logo-text {
            color: white;
        }
        
        .fellow-info {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        
        .fellow-info span {
            font-weight: 500;
        }
        
        .fellow-info .btn--secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .fellow-info .btn--secondary:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .fellow-portal-content {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--space-xl) var(--space-lg);
        }
        
        .fellow-progress-card {
            background: white;
            border-radius: 16px;
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .fellow-progress-card h2 {
            font-family: var(--font-serif);
            font-size: 1.5rem;
            margin-bottom: var(--space-md);
        }
        
        .progress-items {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }
        
        .progress-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            background: var(--color-cream);
            border-radius: 12px;
        }
        
        .progress-icon {
            font-size: 2rem;
        }
        
        .progress-details {
            flex: 1;
        }
        
        .progress-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .progress-status {
            font-size: 0.85rem;
            color: var(--color-text-secondary);
        }
        
        .progress-status--complete {
            color: var(--color-success);
        }
        
        .progress-status--pending {
            color: var(--color-warning);
        }
        
        /* Fellow Survey Form */
        .fellow-section {
            background: white;
            border-radius: 16px;
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .fellow-section.hidden {
            display: none;
        }
        
        .section-header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }
        
        .section-header-bar h2 {
            font-family: var(--font-serif);
            font-size: 1.5rem;
            margin: 0;
        }
        
        .section-intro {
            color: var(--color-text-secondary);
            margin-bottom: var(--space-lg);
        }
        
        .survey-progress-bar {
            height: 8px;
            background: var(--color-sand);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: var(--space-xs);
        }
        
        .survey-progress-fill {
            height: 100%;
            background: var(--color-teal);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .survey-progress-text {
            font-size: 0.85rem;
            color: var(--color-text-muted);
            margin-bottom: var(--space-lg);
        }
        
        .fellow-survey-form .question-card,
        .fellow-checkin-form .question-card {
            background: var(--color-cream);
            border-radius: 12px;
            padding: var(--space-md);
            margin-bottom: var(--space-md);
        }
        
        .question-label {
            display: block;
            font-weight: 600;
            margin-bottom: var(--space-sm);
            font-size: 0.95rem;
        }
        
        .question-hint {
            font-size: 0.85rem;
            color: var(--color-text-muted);
            margin-bottom: var(--space-sm);
        }
        
        .fellow-survey-form textarea,
        .fellow-checkin-form textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--color-stone);
            border-radius: 8px;
            font-family: var(--font-sans);
            font-size: 0.95rem;
            resize: vertical;
        }
        
        .fellow-survey-form textarea:focus,
        .fellow-checkin-form textarea:focus {
            outline: none;
            border-color: var(--color-teal);
        }
        
        /* Rating Scale */
        .rating-scale {
            display: flex;
            gap: 0.5rem;
            margin-bottom: var(--space-xs);
        }
        
        .rating-option {
            flex: 1;
            text-align: center;
        }
        
        .rating-option input {
            display: none;
        }
        
        .rating-option span {
            display: block;
            padding: 0.75rem 0;
            background: var(--color-sand);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .rating-option:hover span {
            background: var(--color-stone);
        }
        
        .rating-option input:checked + span {
            background: var(--color-teal);
            color: white;
        }
        
        .rating-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--color-text-muted);
        }
        
        /* Check-in History */
        .fellow-history-card {
            background: white;
            border-radius: 16px;
            padding: var(--space-lg);
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .fellow-history-card h3 {
            font-family: var(--font-serif);
            margin-bottom: var(--space-md);
        }
        
        .checkin-history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-sm);
            border-bottom: 1px solid var(--color-stone);
        }
        
        .checkin-history-item:last-child {
            border-bottom: none;
        }
        
        .checkin-history-date {
            font-weight: 500;
        }
        
        .checkin-history-rating {
            background: var(--color-teal-light);
            color: var(--color-teal);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .login-card {
            background: white;
            border-radius: 16px;
            padding: var(--space-xl);
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }
        
        .login-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-xs);
        }
        
        .login-logo .logo-mark {
            width: 48px;
            height: 48px;
            font-size: 1.5rem;
        }
        
        .login-logo .logo-text {
            font-family: var(--font-serif);
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--color-text);
        }
        
        .login-subtitle {
            text-align: center;
            color: var(--color-text-muted);
            font-size: 0.9rem;
            margin-bottom: var(--space-lg);
        }
        
        #login-form .form-group {
            margin-bottom: var(--space-md);
        }
        
        #login-form .form-group label {
            display: block;
            margin-bottom: 0.35rem;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--color-text-secondary);
        }
        
        #login-form .form-group input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--color-stone);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s ease;
        }
        
        #login-form .form-group input:focus {
            outline: none;
            border-color: var(--color-teal);
        }
        
        .login-error {
            background: #FEF2F2;
            color: #DC2626;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            margin-bottom: var(--space-md);
            text-align: center;
        }
        
        .login-error.hidden {
            display: none;
        }
        
        .remember-me {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: var(--space-md);
        }
        
        .remember-me input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: var(--color-teal);
            cursor: pointer;
        }
        
        .remember-me label {
            font-size: 0.85rem;
            color: var(--color-text-secondary);
            cursor: pointer;
        }
        
        .login-footer {
            text-align: center;
            font-size: 0.8rem;
            color: var(--color-text-muted);
            margin-top: var(--space-lg);
            line-height: 1.6;
        }
        
        .login-footer a {
            color: var(--color-teal);
            text-decoration: none;
        }
        
        .login-footer a:hover {
            text-decoration: underline;
        }
        
        /* Social Login Buttons */
        .social-login-buttons {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            margin-bottom: var(--space-md);
        }
        
        .social-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            width: 100%;
            padding: 0.85rem 1rem;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid var(--color-stone);
            background: white;
            color: var(--color-text);
        }
        
        .social-btn:hover {
            background: var(--color-cream);
            border-color: var(--color-text-muted);
        }
        
        .social-btn--google:hover {
            border-color: #4285F4;
        }
        
        .social-btn--microsoft:hover {
            border-color: #00A4EF;
        }
        
        .social-btn svg {
            flex-shrink: 0;
        }
        
        .login-divider {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin: var(--space-md) 0;
            color: var(--color-text-muted);
            font-size: 0.85rem;
        }
        
        .login-divider::before,
        .login-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--color-stone);
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        /* Logout button in sidebar */
        .logout-btn {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 0.25rem;
            font-size: 0.95rem;
            color: rgba(255,255,255,0.7);
            background: none;
            border: none;
            width: 100%;
            text-align: left;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        
        body {
            font-family: var(--font-sans);
            background: var(--color-cream);
            color: var(--color-text);
            line-height: 1.6;
        }
        
        /* Layout */
        .app {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--color-text);
            color: white;
            padding: var(--space-md);
            display: flex;
            flex-direction: column;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            font-family: var(--font-serif);
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: var(--space-xl);
        }
        
        .logo-mark {
            width: 36px;
            height: 36px;
            background: var(--color-teal);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }
        
        .nav-section {
            margin-bottom: var(--space-lg);
        }
        
        .nav-section-title {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: rgba(255,255,255,0.5);
            margin-bottom: var(--space-sm);
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 0.25rem;
            font-size: 0.95rem;
        }
        
        .nav-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .nav-item.active {
            background: var(--color-teal);
        }
        
        .nav-item-icon {
            font-size: 1.1rem;
        }
        
        .nav-badge {
            margin-left: auto;
            background: rgba(255,255,255,0.2);
            padding: 0.15rem 0.5rem;
            border-radius: 10px;
            font-size: 0.75rem;
        }
        
        /* Main Content */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: var(--color-warm-white);
            border-bottom: 1px solid var(--color-stone);
            padding: var(--space-md) var(--space-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-family: var(--font-serif);
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .header-actions {
            display: flex;
            gap: var(--space-sm);
        }
        
        .content {
            flex: 1;
            padding: var(--space-lg);
            overflow-y: auto;
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.65rem 1.25rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
            text-decoration: none;
        }
        
        .btn--primary {
            background: var(--color-teal);
            color: white;
        }
        
        .btn--primary:hover {
            background: var(--color-teal-dark);
        }
        
        .btn--secondary {
            background: white;
            color: var(--color-text);
            border: 1px solid var(--color-stone);
        }
        
        .btn--secondary:hover {
            background: var(--color-sand);
        }
        
        /* Survey Form */
        .survey-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .survey-progress {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }
        
        .progress-bar {
            flex: 1;
            height: 8px;
            background: var(--color-stone);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--color-teal);
            transition: width 0.3s ease;
        }
        
        .progress-text {
            font-size: 0.85rem;
            color: var(--color-text-muted);
            white-space: nowrap;
        }
        
        .question-card {
            background: white;
            border: 1px solid var(--color-stone);
            border-radius: 12px;
            padding: var(--space-lg);
            margin-bottom: var(--space-md);
        }
        
        .question-number {
            display: inline-block;
            background: var(--color-teal-light);
            color: var(--color-teal);
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.6rem;
            border-radius: 4px;
            margin-bottom: var(--space-sm);
        }
        
        .question-title {
            font-family: var(--font-serif);
            font-size: 1.15rem;
            font-weight: 600;
            margin-bottom: var(--space-xs);
        }
        
        .question-description {
            font-size: 0.9rem;
            color: var(--color-text-secondary);
            margin-bottom: var(--space-md);
        }
        
        .question-input {
            width: 100%;
            padding: 0.85rem 1rem;
            border: 1px solid var(--color-stone);
            border-radius: 8px;
            font-family: var(--font-sans);
            font-size: 0.95rem;
            resize: vertical;
            min-height: 120px;
            transition: border-color 0.2s ease;
        }
        
        .question-input:focus {
            outline: none;
            border-color: var(--color-teal);
        }
        
        .question-input::placeholder {
            color: var(--color-text-muted);
        }
        
        /* Survey Type Toggle */
        .survey-toggle {
            display: flex;
            background: var(--color-stone);
            border-radius: 10px;
            padding: 4px;
            margin-bottom: var(--space-lg);
        }
        
        .toggle-btn {
            flex: 1;
            padding: 0.75rem 1rem;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-family: var(--font-sans);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--color-text-secondary);
        }
        
        .toggle-btn.active {
            background: white;
            color: var(--color-text);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        /* Respondent Info */
        .respondent-section {
            background: var(--color-teal-light);
            border-radius: 12px;
            padding: var(--space-md);
            margin-bottom: var(--space-lg);
        }
        
        .respondent-section h3 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: var(--space-sm);
            color: var(--color-teal-dark);
        }
        
        .respondent-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-sm);
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }
        
        .form-group label {
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--color-text-secondary);
        }
        
        .form-group input,
        .form-group select {
            padding: 0.6rem 0.85rem;
            border: 1px solid var(--color-stone);
            border-radius: 6px;
            font-family: var(--font-sans);
            font-size: 0.9rem;
            background: white;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--color-teal);
        }
        
        /* Checkbox for manual entry */
        .manual-entry-toggle {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-md);
            padding: var(--space-sm);
            background: var(--color-terracotta-light);
            border-radius: 8px;
        }
        
        .manual-entry-toggle input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--color-terracotta);
        }
        
        .manual-entry-toggle label {
            font-size: 0.9rem;
            color: var(--color-terracotta);
            font-weight: 500;
        }
        
        /* Submit Actions */
        .survey-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: var(--space-lg);
            padding-top: var(--space-lg);
            border-top: 1px solid var(--color-stone);
        }
        
        /* Response List (Admin View) */
        .responses-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }
        
        .response-card {
            background: white;
            border: 1px solid var(--color-stone);
            border-radius: 12px;
            padding: var(--space-md);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .response-card:hover {
            border-color: var(--color-teal);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .response-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-sm);
        }
        
        .response-name {
            font-weight: 600;
            font-size: 1rem;
        }
        
        .response-meta {
            font-size: 0.8rem;
            color: var(--color-text-muted);
        }
        
        .response-type {
            font-size: 0.75rem;
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
            font-weight: 500;
        }
        
        .response-type--survey {
            background: var(--color-teal-light);
            color: var(--color-teal);
        }
        
        .response-type--checkin {
            background: #FEF3E7;
            color: #D97706;
        }
        
        .response-type--manual {
            background: var(--color-terracotta-light);
            color: var(--color-terracotta);
        }
        
        .response-preview {
            font-size: 0.9rem;
            color: var(--color-text-secondary);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .response-tags {
            display: flex;
            gap: 0.5rem;
            margin-top: var(--space-sm);
            flex-wrap: wrap;
        }
        
        .response-tag {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            background: var(--color-sand);
            border-radius: 4px;
            color: var(--color-text-secondary);
        }
        
        /* Filters */
        .filters {
            display: flex;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--color-stone);
            background: white;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .filter-btn:hover {
            border-color: var(--color-teal);
        }
        
        .filter-btn.active {
            background: var(--color-teal);
            color: white;
            border-color: var(--color-teal);
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }
        
        .stat-card {
            background: white;
            border: 1px solid var(--color-stone);
            border-radius: 12px;
            padding: var(--space-md);
        }
        
        .stat-value {
            font-family: var(--font-serif);
            font-size: 2rem;
            font-weight: 600;
            color: var(--color-teal);
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: var(--color-text-muted);
        }
        
        /* Hidden sections */
        .hidden {
            display: none !important;
        }
        
        /* Curation Styles */
        .curation-tab.hidden {
            display: none;
        }
        
        .articles-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }
        
        .article-item {
            background: white;
            border: 1px solid var(--color-stone);
            border-radius: 12px;
            padding: var(--space-md);
            transition: all 0.2s ease;
        }
        
        .article-item:hover {
            border-color: var(--color-teal);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .article-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-sm);
        }
        
        .article-item-title {
            font-family: var(--font-serif);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .article-item-meta {
            font-size: 0.8rem;
            color: var(--color-text-muted);
        }
        
        .article-item-description {
            font-size: 0.9rem;
            color: var(--color-text-secondary);
            margin-bottom: var(--space-sm);
        }
        
        .article-item-actions {
            display: flex;
            gap: var(--space-xs);
        }
        
        .article-item-actions button {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }
        
        .article-category-badge {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .article-category-badge--prevent {
            background: var(--color-teal-light);
            color: var(--color-teal);
        }
        
        .article-category-badge--identify {
            background: #FEF3E7;
            color: #D97706;
        }
        
        .article-category-badge--remove {
            background: var(--color-terracotta-light);
            color: var(--color-terracotta);
        }
        
        .suggestion-source {
            background: var(--color-sand);
            border-radius: 8px;
            padding: var(--space-sm);
            margin-top: var(--space-sm);
            font-size: 0.85rem;
        }
        
        .suggestion-source-title {
            font-weight: 600;
            font-size: 0.75rem;
            color: var(--color-text-muted);
            margin-bottom: 0.25rem;
        }
        
        .pattern-tag {
            display: inline-block;
            background: var(--color-teal-light);
            color: var(--color-teal);
            font-size: 0.75rem;
            padding: 0.15rem 0.5rem;
            border-radius: 4px;
            margin-right: 0.25rem;
            margin-bottom: 0.25rem;
        }
        
        /* Topic Request Styles */
        .topic-item {
            background: white;
            border: 1px solid var(--color-stone);
            border-radius: 12px;
            padding: var(--space-md);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: var(--space-md);
            transition: all 0.2s ease;
        }
        
        .topic-item:hover {
            border-color: var(--color-teal);
        }
        
        .topic-item--new {
            border-left: 4px solid var(--color-terracotta);
        }
        
        .topic-item--reviewed {
            border-left: 4px solid var(--color-teal);
        }
        
        .topic-item--converted {
            border-left: 4px solid #059669;
            background: #F0FDF4;
        }
        
        .topic-content {
            flex: 1;
        }
        
        .topic-text {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: var(--space-xs);
        }
        
        .topic-meta {
            font-size: 0.8rem;
            color: var(--color-text-muted);
        }
        
        .topic-status {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .topic-status--new {
            background: var(--color-terracotta-light);
            color: var(--color-terracotta);
        }
        
        .topic-status--reviewed {
            background: var(--color-teal-light);
            color: var(--color-teal);
        }
        
        .topic-status--converted {
            background: #DCFCE7;
            color: #059669;
        }
        
        .topic-actions {
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }
        
        .topic-actions button {
            font-size: 0.75rem;
            padding: 0.35rem 0.75rem;
        }
        
        /* Sponsor Styles */
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 0.5rem;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--color-stone);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }
        
        .checkbox-item:hover {
            border-color: var(--color-teal);
        }
        
        .checkbox-item:has(input:checked) {
            border-color: var(--color-teal);
            background: var(--color-teal-light);
        }
        
        .checkbox-item input {
            accent-color: var(--color-teal);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-md);
        }
        
        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        
        .question-help {
            font-size: 0.85rem;
            color: var(--color-text-muted);
            margin-bottom: var(--space-sm);
        }
        
        /* Sponsors Grid */
        .sponsors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: var(--space-md);
        }
        
        .sponsor-card {
            background: white;
            border: 1px solid var(--color-stone);
            border-radius: 12px;
            padding: var(--space-md);
            transition: all 0.2s ease;
        }
        
        .sponsor-card:hover {
            border-color: var(--color-teal);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .sponsor-card--active {
            border-left: 4px solid var(--color-success);
        }
        
        .sponsor-card--pending {
            border-left: 4px solid var(--color-warning);
        }
        
        .sponsor-card--prospect {
            border-left: 4px solid var(--color-stone);
        }
        
        .sponsor-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-sm);
        }
        
        .sponsor-name {
            font-family: var(--font-serif);
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .sponsor-status {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .sponsor-status--active {
            background: #DCFCE7;
            color: var(--color-success);
        }
        
        .sponsor-status--pending {
            background: #FEF3C7;
            color: var(--color-warning);
        }
        
        .sponsor-status--prospect {
            background: var(--color-sand);
            color: var(--color-text-muted);
        }
        
        .sponsor-contact {
            font-size: 0.85rem;
            color: var(--color-text-secondary);
            margin-bottom: var(--space-sm);
        }
        
        .sponsor-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 0.35rem;
            margin-bottom: var(--space-sm);
        }
        
        .sponsor-category-tag {
            font-size: 0.7rem;
            padding: 0.15rem 0.5rem;
            background: var(--color-teal-light);
            color: var(--color-teal);
            border-radius: 4px;
        }
        
        .sponsor-meta {
            font-size: 0.8rem;
            color: var(--color-text-muted);
            display: flex;
            justify-content: space-between;
            padding-top: var(--space-sm);
            border-top: 1px solid var(--color-stone);
            margin-top: var(--space-sm);
        }
        
        .sponsor-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: var(--space-sm);
        }
        
        .sponsor-actions button {
            font-size: 0.75rem;
            padding: 0.35rem 0.75rem;
        }
        
        /* Matching Layout */
        .matching-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-lg);
        }
        
        @media (max-width: 900px) {
            .matching-layout {
                grid-template-columns: 1fr;
            }
        }
        
        .matching-panel {
            background: white;
            border: 1px solid var(--color-stone);
            border-radius: 12px;
            padding: var(--space-md);
        }
        
        .matching-panel h3 {
            font-family: var(--font-serif);
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }
        
        .panel-subtitle {
            font-size: 0.8rem;
            color: var(--color-text-muted);
            margin-bottom: var(--space-md);
        }
        
        .needs-list, .services-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .need-item, .service-item {
            padding: 0.75rem;
            background: var(--color-cream);
            border-radius: 8px;
            font-size: 0.85rem;
        }
        
        .need-item {
            border-left: 3px solid var(--color-terracotta);
        }
        
        .service-item {
            border-left: 3px solid var(--color-teal);
        }
        
        .need-source, .service-source {
            font-size: 0.75rem;
            color: var(--color-text-muted);
            margin-top: 0.25rem;
        }
        
        .match-suggestions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--space-md);
        }
        
        .match-card {
            background: white;
            border: 2px solid var(--color-teal);
            border-radius: 12px;
            padding: var(--space-md);
        }
        
        .match-card-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: var(--space-sm);
            font-weight: 600;
            color: var(--color-teal);
        }
        
        .match-need {
            background: var(--color-terracotta-light);
            padding: 0.5rem;
            border-radius: 6px;
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }
        
        .match-sponsor {
            background: var(--color-teal-light);
            padding: 0.5rem;
            border-radius: 6px;
            font-size: 0.85rem;
        }
        
        .match-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: var(--space-sm);
        }
        
        /* Marketing Needs Entries */
        .needs-entries-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }
        
        .needs-entry {
            background: white;
            border: 1px solid var(--color-stone);
            border-radius: 12px;
            padding: var(--space-md);
            transition: all 0.2s ease;
        }
        
        .needs-entry:hover {
            border-color: var(--color-teal);
        }
        
        .needs-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-sm);
        }
        
        .needs-entry-title {
            font-family: var(--font-serif);
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .needs-entry-meta {
            font-size: 0.8rem;
            color: var(--color-text-muted);
        }
        
        .needs-entry-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.35rem;
            margin-bottom: var(--space-sm);
        }
        
        .needs-tag {
            font-size: 0.7rem;
            padding: 0.15rem 0.5rem;
            background: var(--color-sand);
            color: var(--color-text-secondary);
            border-radius: 4px;
        }
        
        .needs-entry-preview {
            font-size: 0.9rem;
            color: var(--color-text-secondary);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-sm);
        }
        
        .needs-preview-item {
            background: var(--color-cream);
            padding: 0.5rem;
            border-radius: 6px;
        }
        
        .needs-preview-label {
            font-size: 0.75rem;
            color: var(--color-text-muted);
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        
        .needs-preview-text {
            font-size: 0.85rem;
        }
        
        .needs-entry-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: var(--space-sm);
            padding-top: var(--space-sm);
            border-top: 1px solid var(--color-stone);
        }
        
        /* Insights Grid */
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--space-md);
            margin-top: var(--space-md);
        }
        
        .insight-card {
            background: white;
            border: 1px solid var(--color-stone);
            border-radius: 12px;
            padding: var(--space-md);
        }
        
        .insight-card h4 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: var(--space-xs);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .insight-card ul {
            font-size: 0.85rem;
            color: var(--color-text-secondary);
            padding-left: 1.25rem;
            margin: 0;
        }
        
        .insight-card li {
            margin-bottom: 0.25rem;
        }
        
        .insight-count {
            font-size: 0.7rem;
            background: var(--color-teal-light);
            color: var(--color-teal);
            padding: 0.1rem 0.4rem;
            border-radius: 10px;
        }
        
        /* Relocation Pipeline */
        .pipeline-stats {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            flex-wrap: wrap;
            background: white;
            border: 1px solid var(--color-stone);
            border-radius: 12px;
            padding: var(--space-md);
        }
        
        .pipeline-stat {
            text-align: center;
            padding: var(--space-sm) var(--space-md);
            min-width: 80px;
        }
        
        .pipeline-stat-value {
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--color-teal);
        }
        
        .pipeline-stat-label {
            font-size: 0.75rem;
            color: var(--color-text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .pipeline-arrow {
            color: var(--color-stone);
            font-size: 1.25rem;
        }
        
        /* Revenue Tracker */
        .revenue-tracker {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-md);
        }
        
        .revenue-card {
            background: white;
            border: 1px solid var(--color-stone);
            border-radius: 12px;
            padding: var(--space-md);
            text-align: center;
        }
        
        .revenue-card--earned {
            background: linear-gradient(135deg, var(--color-teal) 0%, var(--color-teal-dark) 100%);
            border: none;
            color: white;
        }
        
        .revenue-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--space-xs);
        }
        
        .revenue-card:not(.revenue-card--earned) .revenue-label {
            color: var(--color-text-muted);
        }
        
        .revenue-value {
            font-size: 2rem;
            font-weight: 600;
        }
        
        .revenue-card:not(.revenue-card--earned) .revenue-value {
            color: var(--color-text);
        }
        
        .revenue-note {
            font-size: 0.75rem;
            margin-top: var(--space-xs);
        }
        
        .revenue-card:not(.revenue-card--earned) .revenue-note {
            color: var(--color-text-muted);
        }
        
        .revenue-card--earned .revenue-note {
            opacity: 0.8;
        }
        
        /* Relocations List */
        .relocations-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }
        
        .relocation-card {
            background: white;
            border: 1px solid var(--color-stone);
            border-radius: 12px;
            padding: var(--space-md);
            transition: all 0.2s ease;
        }
        
        .relocation-card:hover {
            border-color: var(--color-teal);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .relocation-card--new { border-left: 4px solid var(--color-terracotta); }
        .relocation-card--contacted { border-left: 4px solid var(--color-warning); }
        .relocation-card--matched { border-left: 4px solid #8B5CF6; }
        .relocation-card--active { border-left: 4px solid var(--color-teal); }
        .relocation-card--closed { border-left: 4px solid var(--color-success); }
        
        .relocation-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-sm);
        }
        
        .relocation-name {
            font-family: var(--font-serif);
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .relocation-status {
            font-size: 0.7rem;
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .relocation-status--new { background: var(--color-terracotta-light); color: var(--color-terracotta); }
        .relocation-status--contacted { background: #FEF3C7; color: var(--color-warning); }
        .relocation-status--matched { background: #EDE9FE; color: #8B5CF6; }
        .relocation-status--active { background: var(--color-teal-light); color: var(--color-teal); }
        .relocation-status--closed { background: #DCFCE7; color: var(--color-success); }
        
        .relocation-route {
            font-size: 1rem;
            color: var(--color-text);
            margin-bottom: var(--space-xs);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .relocation-route-arrow {
            color: var(--color-teal);
        }
        
        .relocation-meta {
            font-size: 0.85rem;
            color: var(--color-text-secondary);
            margin-bottom: var(--space-sm);
        }
        
        .relocation-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-sm);
            padding: var(--space-sm);
            background: var(--color-cream);
            border-radius: 8px;
            font-size: 0.85rem;
            margin-bottom: var(--space-sm);
        }
        
        .relocation-detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .relocation-detail-label {
            font-size: 0.7rem;
            color: var(--color-text-muted);
            text-transform: uppercase;
        }
        
        .relocation-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            padding-top: var(--space-sm);
            border-top: 1px solid var(--color-stone);
        }
        
        @media (max-width: 768px) {
            .pipeline-stats {
                gap: var(--space-xs);
            }
            
            .pipeline-stat {
                padding: var(--space-xs);
                min-width: 60px;
            }
            
            .pipeline-stat-value {
                font-size: 1.25rem;
            }
            
            .pipeline-arrow {
                display: none;
            }
            
            .revenue-tracker {
                grid-template-columns: 1fr;
            }
        }
        
        /* Response Detail Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: var(--space-md) var(--space-lg);
            border-bottom: 1px solid var(--color-stone);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
            z-index: 1;
        }
        
        .modal-header h2 {
            font-family: var(--font-serif);
            font-size: 1.25rem;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--color-text-muted);
        }
        
        .modal-body {
            padding: var(--space-lg);
        }
        
        .modal-response-item {
            margin-bottom: var(--space-lg);
        }
        
        .modal-response-item:last-child {
            margin-bottom: 0;
        }
        
        .modal-question {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--color-teal);
            margin-bottom: 0.25rem;
        }
        
        .modal-answer {
            font-size: 0.95rem;
            color: var(--color-text-secondary);
            white-space: pre-wrap;
        }
        
        /* Success Message */
        .success-message {
            background: #ECFDF5;
            border: 1px solid #059669;
            border-radius: 12px;
            padding: var(--space-lg);
            text-align: center;
        }
        
        .success-icon {
            font-size: 3rem;
            margin-bottom: var(--space-sm);
        }
        
        .success-message h2 {
            font-family: var(--font-serif);
            color: #059669;
            margin-bottom: var(--space-xs);
        }
        
        .success-message p {
            color: var(--color-text-secondary);
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <!-- Landing Screen - Choose Path -->
    <div id="landing-screen" class="landing-screen">
        <div class="landing-container">
            <div class="landing-header">
                <div class="landing-logo">
                    <span class="logo-mark">R</span>
                    <span class="logo-text">REACH Exchange</span>
                </div>
                <p class="landing-tagline">Connecting medical trainees with the services they need</p>
            </div>
            
            <div class="landing-cards">
                <!-- Fellow Card -->
                <div class="landing-card landing-card--fellow">
                    <div class="landing-card-icon"></div>
                    <h2>Fellows</h2>
                    <p>Current REACH Fellows: complete your surveys, check-ins, and track your K-award progress</p>
                    <button class="btn btn--primary btn--large" onclick="showFellowLogin()">
                        Fellow Portal 
                    </button>
                </div>
                
                <!-- Sponsor Card -->
                <div class="landing-card landing-card--sponsor">
                    <div class="landing-card-icon"></div>
                    <h2>Sponsors</h2>
                    <p>Service providers: partner with REACH to connect with medical trainees during career transitions</p>
                    <button class="btn btn--primary btn--large" onclick="showSponsorPortal()">
                        Become a Sponsor 
                    </button>
                </div>
            </div>
            
            <div class="landing-footer">
                <p><a href="https://reachpartnerships.org">REACH Partnerships Foundation</a>  <a href="reach-access.html">REACH Access Wiki</a></p>
            </div>
        </div>
    </div>
    
    <!-- Fellow Login Screen - Social Login -->
    <div id="fellow-login-screen" class="login-screen hidden">
        <div class="login-card">
            <div class="login-logo">
                <span class="logo-mark">R</span>
                <span class="logo-text">Fellow Portal</span>
            </div>
            <p class="login-subtitle">REACH Fellowship Program</p>
            
            <div class="social-login-buttons">
                <button class="social-btn social-btn--google" onclick="showComingSoon()">
                    <svg viewBox="0 0 24 24" width="20" height="20">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Continue with Google
                </button>
                <button class="social-btn social-btn--microsoft" onclick="showComingSoon()">
                    <svg viewBox="0 0 24 24" width="20" height="20">
                        <path fill="#F25022" d="M1 1h10v10H1z"/>
                        <path fill="#00A4EF" d="M1 13h10v10H1z"/>
                        <path fill="#7FBA00" d="M13 1h10v10H13z"/>
                        <path fill="#FFB900" d="M13 13h10v10H13z"/>
                    </svg>
                    Continue with Microsoft
                </button>
            </div>
            
            <div class="login-divider">
                <span>or</span>
            </div>
            
            <div id="fellow-login-step1">
                <p style="color: var(--color-text-secondary); font-size: 0.85rem; margin-bottom: var(--space-md); text-align: center;">Sign in with your registered email</p>
                <form id="fellow-email-form" onsubmit="handleFellowEmailLogin(event)">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="fellow-login-email" placeholder="your.email@institution.edu" required />
                    </div>
                    <div id="fellow-login-error" class="login-error hidden">
                        This email is not registered. Contact info@reachpartnerships.org
                    </div>
                    <button type="submit" class="btn btn--secondary" style="width: 100%; justify-content: center;">
                        Continue with Email
                    </button>
                </form>
            </div>
            
            <p class="login-footer">
                <a href="#" onclick="showLandingScreen(); return false;"> Back to REACH Exchange</a><br><br>
                <span style="font-size: 0.75rem;">Not registered? Contact info@reachpartnerships.org</span>
            </p>
        </div>
    </div>
    
    <!-- Fellow Portal -->
    <div id="fellow-portal" class="fellow-portal hidden">
        <div class="fellow-portal-header">
            <div class="fellow-portal-nav">
                <div class="landing-logo">
                    <span class="logo-mark">R</span>
                    <span class="logo-text">Fellow Portal</span>
                </div>
                <div class="fellow-info">
                    <span id="fellow-name-display">Fellow</span>
                    <button class="btn btn--secondary btn--small" onclick="handleFellowLogout()">Sign Out</button>
                </div>
            </div>
        </div>
        
        <div class="fellow-portal-content">
            <!-- Progress Overview -->
            <div class="fellow-progress-card">
                <h2>Your Progress</h2>
                <div class="progress-items">
                    <div class="progress-item" id="progress-survey">
                        <div class="progress-icon"></div>
                        <div class="progress-details">
                            <div class="progress-title">14-Question Survey</div>
                            <div class="progress-status" id="survey-status">Not started</div>
                        </div>
                        <button class="btn btn--primary btn--small" id="survey-action-btn" onclick="showFellowSurvey()">Start Survey</button>
                    </div>
                    <div class="progress-item" id="progress-checkin">
                        <div class="progress-icon"></div>
                        <div class="progress-details">
                            <div class="progress-title">Weekly Check-in</div>
                            <div class="progress-status" id="checkin-status">Due this week</div>
                        </div>
                        <button class="btn btn--primary btn--small" id="checkin-action-btn" onclick="showWeeklyCheckin()">Check In</button>
                    </div>
                </div>
            </div>
            
            <!-- Survey Section -->
            <div id="fellow-survey-section" class="fellow-section hidden">
                <div class="section-header-bar">
                    <h2> Fellowship Survey</h2>
                    <button class="btn btn--secondary btn--small" onclick="hideFellowSurvey()"> Back to Dashboard</button>
                </div>
                <p class="section-intro">Complete all 14 questions to help us understand your research and connect you with resources. Your responses will be used to match you with sponsors and create content for REACH Access.</p>
                
                <form id="fellow-survey-form" class="fellow-survey-form">
                    <div class="survey-progress-bar">
                        <div class="survey-progress-fill" id="survey-progress-fill"></div>
                    </div>
                    <p class="survey-progress-text"><span id="questions-answered">0</span> of 14 questions answered</p>
                    
                    <!-- Questions will be rendered here -->
                    <div id="fellow-questions-container"></div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn--secondary" onclick="saveFellowSurveyDraft()">Save Draft</button>
                        <button type="submit" class="btn btn--primary" onclick="submitFellowSurvey(event)">Submit Survey</button>
                    </div>
                </form>
            </div>
            
            <!-- Weekly Check-in Section -->
            <div id="fellow-checkin-section" class="fellow-section hidden">
                <div class="section-header-bar">
                    <h2> Weekly Check-in</h2>
                    <button class="btn btn--secondary btn--small" onclick="hideWeeklyCheckin()"> Back to Dashboard</button>
                </div>
                <p class="section-intro">Quick 5-minute update on your progress. This helps us identify patterns and connect you with support.</p>
                
                <form id="fellow-checkin-form" class="fellow-checkin-form">
                    <div class="question-card">
                        <label class="question-label">How would you rate your research progress this week?</label>
                        <div class="rating-scale">
                            <label class="rating-option"><input type="radio" name="progress-rating" value="1" /><span>1</span></label>
                            <label class="rating-option"><input type="radio" name="progress-rating" value="2" /><span>2</span></label>
                            <label class="rating-option"><input type="radio" name="progress-rating" value="3" /><span>3</span></label>
                            <label class="rating-option"><input type="radio" name="progress-rating" value="4" /><span>4</span></label>
                            <label class="rating-option"><input type="radio" name="progress-rating" value="5" /><span>5</span></label>
                            <label class="rating-option"><input type="radio" name="progress-rating" value="6" /><span>6</span></label>
                            <label class="rating-option"><input type="radio" name="progress-rating" value="7" /><span>7</span></label>
                            <label class="rating-option"><input type="radio" name="progress-rating" value="8" /><span>8</span></label>
                            <label class="rating-option"><input type="radio" name="progress-rating" value="9" /><span>9</span></label>
                            <label class="rating-option"><input type="radio" name="progress-rating" value="10" /><span>10</span></label>
                        </div>
                        <div class="rating-labels">
                            <span>No progress</span>
                            <span>Excellent progress</span>
                        </div>
                    </div>
                    
                    <div class="question-card">
                        <label class="question-label">What did you accomplish this week?</label>
                        <textarea id="checkin-accomplishments" rows="3" placeholder="Key activities, milestones reached, data collected..."></textarea>
                    </div>
                    
                    <div class="question-card">
                        <label class="question-label">What barriers or challenges are you facing?</label>
                        <textarea id="checkin-barriers" rows="3" placeholder="IRB delays, recruitment issues, technical problems, time constraints..."></textarea>
                    </div>
                    
                    <div class="question-card">
                        <label class="question-label">What resources or support would help you right now?</label>
                        <div class="checkbox-grid">
                            <label class="checkbox-item"><input type="checkbox" name="checkin-needs" value="statistical-help" /><span>Statistical consulting</span></label>
                            <label class="checkbox-item"><input type="checkbox" name="checkin-needs" value="writing-help" /><span>Writing/editing support</span></label>
                            <label class="checkbox-item"><input type="checkbox" name="checkin-needs" value="mentor-meeting" /><span>Mentor meeting</span></label>
                            <label class="checkbox-item"><input type="checkbox" name="checkin-needs" value="funding" /><span>Additional funding</span></label>
                            <label class="checkbox-item"><input type="checkbox" name="checkin-needs" value="recruitment" /><span>Recruitment help</span></label>
                            <label class="checkbox-item"><input type="checkbox" name="checkin-needs" value="irb" /><span>IRB/regulatory guidance</span></label>
                            <label class="checkbox-item"><input type="checkbox" name="checkin-needs" value="technical" /><span>Technical support</span></label>
                            <label class="checkbox-item"><input type="checkbox" name="checkin-needs" value="relocation" /><span>Relocation assistance</span></label>
                        </div>
                        <textarea id="checkin-needs-other" rows="2" placeholder="Other specific needs..." style="margin-top: 0.5rem;"></textarea>
                    </div>
                    
                    <div class="question-card">
                        <label class="question-label">How are you doing personally? (Optional, confidential)</label>
                        <div class="rating-scale">
                            <label class="rating-option"><input type="radio" name="wellbeing-rating" value="1" /><span>1</span></label>
                            <label class="rating-option"><input type="radio" name="wellbeing-rating" value="2" /><span>2</span></label>
                            <label class="rating-option"><input type="radio" name="wellbeing-rating" value="3" /><span>3</span></label>
                            <label class="rating-option"><input type="radio" name="wellbeing-rating" value="4" /><span>4</span></label>
                            <label class="rating-option"><input type="radio" name="wellbeing-rating" value="5" /><span>5</span></label>
                        </div>
                        <div class="rating-labels">
                            <span>Struggling</span>
                            <span>Great</span>
                        </div>
                    </div>
                    
                    <div class="question-card">
                        <label class="question-label">Anything else you'd like to share?</label>
                        <textarea id="checkin-other" rows="2" placeholder="Questions, updates, concerns..."></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn--primary btn--large" style="width: 100%;" onclick="submitWeeklyCheckin(event)">Submit Check-in</button>
                    </div>
                </form>
            </div>
            
            <!-- Check-in History -->
            <div class="fellow-history-card" id="checkin-history-card">
                <h3>Your Check-in History</h3>
                <div id="checkin-history-list">
                    <!-- History rendered here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Login Screen (Admin) -->
    <div id="login-screen" class="login-screen hidden">
        <div class="login-card">
            <div class="login-logo">
                <span class="logo-mark">R</span>
                <span class="logo-text">REACH Exchange</span>
            </div>
            <p class="login-subtitle">Admin Portal</p>
            
            <form id="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="login-email" placeholder="admin@reachpartnerships.org" required />
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="login-password" placeholder="" required />
                </div>
                <div class="remember-me">
                    <input type="checkbox" id="remember-me" />
                    <label for="remember-me">Remember me for 30 days</label>
                </div>
                <div id="login-error" class="login-error hidden">
                    Invalid email or password
                </div>
                <button type="submit" class="btn btn--primary" style="width: 100%; justify-content: center;">
                    Sign In
                </button>
            </form>
            
            <p class="login-footer">
                <a href="#" onclick="showLandingScreen(); return false;"> Back to REACH Exchange</a>
            </p>
        </div>
    </div>
    
    <!-- Sponsor Portal (Public) -->
    <div id="sponsor-portal" class="sponsor-portal hidden">
        <div class="sponsor-portal-header">
            <div class="sponsor-portal-nav">
                <a href="#" onclick="showLandingScreen(); return false;" class="back-link"> Back</a>
                <div class="landing-logo">
                    <span class="logo-mark">R</span>
                    <span class="logo-text">REACH Exchange</span>
                </div>
                <span class="portal-badge">Sponsor Portal</span>
            </div>
        </div>
        
        <div class="sponsor-portal-content">
            <div class="sponsor-portal-intro">
                <h1>Partner with REACH</h1>
                <p class="intro-lead">REACH connects service providers with medical trainees during key career transitionswhen they need your services most.</p>
                
                <div class="value-props">
                    <div class="value-prop">
                        <div class="value-prop-icon"></div>
                        <h3>Reach the Right Audience</h3>
                        <p>Medical trainees relocating for residency, fellowship, or attending positions. High earning potential, creditworthy, and building long-term professional habits.</p>
                    </div>
                    <div class="value-prop">
                        <div class="value-prop-icon"></div>
                        <h3>Perfect Timing</h3>
                        <p>Connect during transition moments: moving to a new city, buying a first home, starting a new role, managing student loans, reviewing contracts.</p>
                    </div>
                    <div class="value-prop">
                        <div class="value-prop-icon"></div>
                        <h3>Support Medical Research</h3>
                        <p>Sponsorship fees fund research fellowships for the next generation of physician-scientists. Your business growth directly supports medical education.</p>
                    </div>
                </div>
            </div>
            
            <div class="sponsor-portal-form-container">
                <div class="sponsor-form-card">
                    <h2>Tell Us About Your Business</h2>
                    <p class="form-intro">Complete this form and we'll be in touch within 2 business days to discuss how we can work together.</p>
                    
                    <form id="public-sponsor-form" onsubmit="submitPublicSponsorForm(event)">
                        <!-- Contact Info -->
                        <div class="form-section-title">Contact Information</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Your Name *</label>
                                <input type="text" id="pub-sponsor-name" required />
                            </div>
                            <div class="form-group">
                                <label>Company/Business Name *</label>
                                <input type="text" id="pub-sponsor-company" required />
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Email *</label>
                                <input type="email" id="pub-sponsor-email" required />
                            </div>
                            <div class="form-group">
                                <label>Phone *</label>
                                <input type="tel" id="pub-sponsor-phone" required />
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Website</label>
                            <input type="url" id="pub-sponsor-website" placeholder="https://" />
                        </div>
                        
                        <!-- Service Info -->
                        <div class="form-section-title">Your Services</div>
                        <div class="form-group">
                            <label>What type of services do you offer? *</label>
                            <div class="checkbox-grid">
                                <label class="checkbox-item">
                                    <input type="checkbox" name="pub-sponsor-category" value="real-estate" />
                                    <span> Real Estate</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="pub-sponsor-category" value="mortgage" />
                                    <span> Mortgage/Lending</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="pub-sponsor-category" value="financial" />
                                    <span> Financial Planning</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="pub-sponsor-category" value="insurance" />
                                    <span> Insurance</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="pub-sponsor-category" value="legal" />
                                    <span> Legal Services</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="pub-sponsor-category" value="moving" />
                                    <span> Moving Services</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="pub-sponsor-category" value="tax" />
                                    <span> Tax/Accounting</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="pub-sponsor-category" value="career" />
                                    <span> Career Services</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="pub-sponsor-category" value="wellness" />
                                    <span> Wellness/Coaching</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="pub-sponsor-category" value="other" />
                                    <span> Other</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Describe your services *</label>
                            <textarea id="pub-sponsor-services" rows="3" required placeholder="What specific services do you offer? What makes you a great fit for medical trainees?"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Geographic coverage *</label>
                            <input type="text" id="pub-sponsor-geography" required placeholder="e.g., Atlanta metro, Georgia, Southeast, National" />
                        </div>
                        <div class="form-group">
                            <label>Any special offers for REACH trainees?</label>
                            <input type="text" id="pub-sponsor-offers" placeholder="e.g., Free consultation, waived fees, discount..." />
                        </div>
                        
                        <!-- What They Want -->
                        <div class="form-section-title">Your Goals</div>
                        <div class="form-group">
                            <label>What are you hoping to achieve? *</label>
                            <textarea id="pub-sponsor-goals" rows="3" required placeholder="e.g., Reach more physician clients, build brand awareness in the medical community, support medical education..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>How do you currently reach medical professionals?</label>
                            <textarea id="pub-sponsor-current" rows="2" placeholder="e.g., Referrals, social media, hospital partnerships, not currently reaching them..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>What's been challenging about reaching this market?</label>
                            <textarea id="pub-sponsor-challenges" rows="2" placeholder="What's been difficult or frustrating?"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Monthly marketing budget</label>
                                <select id="pub-sponsor-budget">
                                    <option value="">Select...</option>
                                    <option value="under-500">Under $500</option>
                                    <option value="500-1000">$500 - $1,000</option>
                                    <option value="1000-2500">$1,000 - $2,500</option>
                                    <option value="2500-plus">$2,500+</option>
                                    <option value="flexible">Flexible / ROI-based</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>How did you hear about REACH?</label>
                                <select id="pub-sponsor-source">
                                    <option value="">Select...</option>
                                    <option value="reach-access">REACH Access website</option>
                                    <option value="reach-website">REACH main website</option>
                                    <option value="referral">Referral</option>
                                    <option value="search">Google/Search</option>
                                    <option value="social">Social media</option>
                                    <option value="event">Event/Conference</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Anything else you'd like us to know?</label>
                            <textarea id="pub-sponsor-notes" rows="2" placeholder="Questions, ideas, specific interests..."></textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn--primary btn--large" style="width: 100%;">Submit Application</button>
                        </div>
                    </form>
                    
                    <div id="sponsor-form-success" class="sponsor-form-success hidden">
                        <div class="success-icon"></div>
                        <h3>Application Submitted!</h3>
                        <p>Thanks for your interest in partnering with REACH. We'll review your information and be in touch within 2 business days.</p>
                        <div class="success-details">
                            <p><strong>What happens next:</strong></p>
                            <ol>
                                <li>We'll review your application</li>
                                <li>A team member will reach out to schedule a call</li>
                                <li>We'll discuss partnership options and pricing</li>
                                <li>Once approved, you'll get access to the sponsor dashboard</li>
                            </ol>
                        </div>
                        <button class="btn btn--secondary" onclick="showLandingScreen()">Return to REACH Exchange</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="sponsor-portal-footer">
            <p>REACH Partnerships Foundation  <a href="https://reachpartnerships.org">reachpartnerships.org</a></p>
        </div>
    </div>
    
    <!-- Main App (hidden until logged in) -->
    <div class="app hidden" id="main-app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <span class="logo-mark">R</span>
                REACH Exchange
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Surveys</div>
                <div class="nav-item active" data-view="new-survey">
                    <span class="nav-item-icon"></span>
                    New Survey
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Relocation</div>
                <div class="nav-item" data-view="relocation-intake">
                    <span class="nav-item-icon"></span>
                    New Request
                </div>
                <div class="nav-item" data-view="relocations">
                    <span class="nav-item-icon"></span>
                    All Relocations
                    <span class="nav-badge" id="relocation-count">0</span>
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Sponsors</div>
                <div class="nav-item" data-view="new-sponsor">
                    <span class="nav-item-icon"></span>
                    Add Sponsor
                </div>
                <div class="nav-item" data-view="sponsor-needs">
                    <span class="nav-item-icon"></span>
                    Marketing Needs
                    <span class="nav-badge" id="sponsor-needs-count">0</span>
                </div>
                <div class="nav-item" data-view="sponsors">
                    <span class="nav-item-icon"></span>
                    All Sponsors
                    <span class="nav-badge" id="sponsor-count">0</span>
                </div>
                <div class="nav-item" data-view="matching">
                    <span class="nav-item-icon"></span>
                    Needs Matching
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Admin</div>
                <div class="nav-item" data-view="dashboard">
                    <span class="nav-item-icon"></span>
                    Dashboard
                </div>
                <div class="nav-item" data-view="responses">
                    <span class="nav-item-icon"></span>
                    All Responses
                    <span class="nav-badge" id="response-count">0</span>
                </div>
                <div class="nav-item" data-view="patterns">
                    <span class="nav-item-icon"></span>
                    Patterns
                </div>
                <div class="nav-item" data-view="curation">
                    <span class="nav-item-icon"></span>
                    Article Curation
                    <span class="nav-badge" id="suggestion-count">0</span>
                </div>
                <div class="nav-item" data-view="topics">
                    <span class="nav-item-icon"></span>
                    Topic Requests
                    <span class="nav-badge" id="topic-count">0</span>
                </div>
            </div>
            
            <div class="nav-section" style="margin-top: auto;">
                <div class="nav-item" data-view="export">
                    <span class="nav-item-icon"></span>
                    Export Data
                </div>
                <button class="logout-btn" onclick="handleLogout()">
                    <span class="nav-item-icon"></span>
                    Sign Out
                </button>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="main">
            <!-- New Survey View -->
            <div id="view-new-survey" class="view">
                <header class="header">
                    <h1>New Survey Response</h1>
                </header>
                <div class="content">
                    <div class="survey-container">
                        <!-- Manual Entry Toggle -->
                        <div class="manual-entry-toggle">
                            <input type="checkbox" id="manual-entry" />
                            <label for="manual-entry">Manual entry (I'm entering this on behalf of someone I interviewed)</label>
                        </div>
                        
                        <!-- Survey Type Toggle -->
                        <div class="survey-toggle">
                            <button class="toggle-btn active" data-survey="full">12-14 Question Survey</button>
                            <button class="toggle-btn" data-survey="checkin">Weekly Check-in</button>
                        </div>
                        
                        <!-- Respondent Info -->
                        <div class="respondent-section">
                            <h3>Respondent Information</h3>
                            <div class="respondent-grid">
                                <div class="form-group">
                                    <label>Name</label>
                                    <input type="text" id="respondent-name" placeholder="Full name" />
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" id="respondent-email" placeholder="email@example.com" />
                                </div>
                                <div class="form-group">
                                    <label>Role</label>
                                    <select id="respondent-role">
                                        <option value="">Select role...</option>
                                        <option value="medical-student">Medical Student</option>
                                        <option value="resident">Resident</option>
                                        <option value="fellow">Clinical Fellow</option>
                                        <option value="attending">Early-Career Attending</option>
                                        <option value="apc">Advanced Practice Clinician</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Institution</label>
                                    <input type="text" id="respondent-institution" placeholder="e.g., Emory University" />
                                </div>
                            </div>
                        </div>
                        
                        <!-- Progress -->
                        <div class="survey-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                            </div>
                            <span class="progress-text" id="progress-text">0 of 14 questions</span>
                        </div>
                        
                        <!-- Questions Container -->
                        <div id="questions-container">
                            <!-- Questions will be rendered here -->
                        </div>
                        
                        <!-- Success Message (hidden by default) -->
                        <div id="success-message" class="success-message hidden">
                            <div class="success-icon"></div>
                            <h2>Survey Submitted!</h2>
                            <p>Thank you for completing the survey. Your responses have been saved.</p>
                            <button class="btn btn--primary" onclick="resetSurvey()" style="margin-top: var(--space-md);">
                                Submit Another Response
                            </button>
                        </div>
                        
                        <!-- Submit Actions -->
                        <div class="survey-actions" id="survey-actions">
                            <button class="btn btn--secondary" onclick="saveDraft()">Save Draft</button>
                            <button class="btn btn--primary" onclick="submitSurvey()">Submit Survey </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Dashboard View -->
            <div id="view-dashboard" class="view hidden">
                <header class="header">
                    <h1>Dashboard</h1>
                </header>
                <div class="content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="stat-total">0</div>
                            <div class="stat-label">Total Responses</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="stat-surveys">0</div>
                            <div class="stat-label">Full Surveys</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="stat-checkins">0</div>
                            <div class="stat-label">Weekly Check-ins</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="stat-manual">0</div>
                            <div class="stat-label">Manual Entries</div>
                        </div>
                    </div>
                    
                    <h2 style="font-family: var(--font-serif); margin-bottom: var(--space-md);">Recent Responses</h2>
                    <div id="recent-responses" class="responses-list">
                        <!-- Recent responses will be rendered here -->
                    </div>
                </div>
            </div>
            
            <!-- All Responses View -->
            <div id="view-responses" class="view hidden">
                <header class="header">
                    <h1>All Responses</h1>
                    <div class="header-actions">
                        <button class="btn btn--secondary" onclick="exportData()">Export CSV</button>
                    </div>
                </header>
                <div class="content">
                    <div class="filters">
                        <button class="filter-btn active" data-filter="all">All</button>
                        <button class="filter-btn" data-filter="full">Full Surveys</button>
                        <button class="filter-btn" data-filter="checkin">Check-ins</button>
                        <button class="filter-btn" data-filter="manual">Manual Entries</button>
                    </div>
                    <div id="all-responses" class="responses-list">
                        <!-- All responses will be rendered here -->
                    </div>
                </div>
            </div>
            
            <!-- Patterns View -->
            <div id="view-patterns" class="view hidden">
                <header class="header">
                    <h1>Patterns & Insights</h1>
                    <div class="header-actions">
                        <button class="btn btn--primary" onclick="analyzePatterns()"> Analyze Responses</button>
                    </div>
                </header>
                <div class="content">
                    <div class="stats-grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom: var(--space-lg);">
                        <div class="stat-card">
                            <div class="stat-value" id="pattern-barriers">0</div>
                            <div class="stat-label">Barriers Mentioned</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="pattern-resources">0</div>
                            <div class="stat-label">Resources Needed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="pattern-themes">0</div>
                            <div class="stat-label">Common Themes</div>
                        </div>
                    </div>
                    
                    <div id="patterns-output" class="question-card">
                        <h3 style="margin-bottom: var(--space-sm);">Pattern Analysis</h3>
                        <p style="color: var(--color-text-secondary);">
                            Click "Analyze Responses" to have the LLM identify patterns across all survey responses. This will generate article suggestions for REACH Access.
                        </p>
                    </div>
                    
                    <div id="patterns-loading" class="hidden" style="text-align: center; padding: var(--space-xl);">
                        <div style="font-size: 2rem; margin-bottom: var(--space-sm);"></div>
                        <p style="color: var(--color-text-muted);">Analyzing patterns across responses...</p>
                    </div>
                </div>
            </div>
            
            <!-- Curation View -->
            <div id="view-curation" class="view hidden">
                <header class="header">
                    <h1>Article Curation</h1>
                    <div class="header-actions">
                        <button class="btn btn--secondary" onclick="showTab('suggestions')">Suggestions</button>
                        <button class="btn btn--secondary" onclick="showTab('drafts')">Drafts</button>
                        <button class="btn btn--secondary" onclick="showTab('published')">Published</button>
                        <button class="btn btn--primary" onclick="createNewArticle()">+ New Article</button>
                    </div>
                </header>
                <div class="content">
                    <!-- Suggestions Tab -->
                    <div id="tab-suggestions" class="curation-tab">
                        <div class="section-intro" style="margin-bottom: var(--space-lg);">
                            <p style="color: var(--color-text-secondary);">
                                LLM-generated article suggestions based on survey patterns. Review, edit, and publish to REACH Access.
                            </p>
                        </div>
                        <div id="suggestions-list" class="articles-list">
                            <!-- Suggestions rendered here -->
                        </div>
                    </div>
                    
                    <!-- Drafts Tab -->
                    <div id="tab-drafts" class="curation-tab hidden">
                        <div id="drafts-list" class="articles-list">
                            <!-- Drafts rendered here -->
                        </div>
                    </div>
                    
                    <!-- Published Tab -->
                    <div id="tab-published" class="curation-tab hidden">
                        <div id="published-list" class="articles-list">
                            <!-- Published rendered here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Article Editor Modal -->
            <div id="editor-modal" class="modal-overlay hidden">
                <div class="modal" style="max-width: 900px;">
                    <div class="modal-header">
                        <h2 id="editor-title">Edit Article</h2>
                        <button class="modal-close" onclick="closeEditor()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group" style="margin-bottom: var(--space-md);">
                            <label>Category</label>
                            <select id="editor-category">
                                <option value="prevent"> Preventing Issues</option>
                                <option value="identify"> Identifying Problems</option>
                                <option value="remove"> Removing Barriers</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom: var(--space-md);">
                            <label>Title</label>
                            <input type="text" id="editor-article-title" style="width: 100%;" />
                        </div>
                        <div class="form-group" style="margin-bottom: var(--space-md);">
                            <label>Description (for preview cards)</label>
                            <textarea id="editor-description" style="min-height: 60px;"></textarea>
                        </div>
                        <div class="form-group" style="margin-bottom: var(--space-md);">
                            <label>Content (HTML)</label>
                            <textarea id="editor-content" style="min-height: 300px; font-family: monospace; font-size: 0.85rem;"></textarea>
                        </div>
                        <div class="form-group" style="margin-bottom: var(--space-md);">
                            <label>Source Patterns (comma-separated)</label>
                            <input type="text" id="editor-patterns" style="width: 100%;" placeholder="e.g., IRB delays, mentor search, burnout" />
                        </div>
                        <div style="display: flex; gap: var(--space-sm); justify-content: flex-end; margin-top: var(--space-lg);">
                            <button class="btn btn--secondary" onclick="saveAsDraft()">Save as Draft</button>
                            <button class="btn btn--primary" onclick="publishArticle()">Publish to REACH Access</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Export View -->
            <div id="view-export" class="view hidden">
                <header class="header">
                    <h1>Export Data</h1>
                </header>
                <div class="content">
                    <div class="question-card">
                        <h3 style="margin-bottom: var(--space-sm);">Export All Responses</h3>
                        <p style="margin-bottom: var(--space-md); color: var(--color-text-secondary);">
                            Download all survey responses as a JSON file for backup or analysis.
                        </p>
                        <button class="btn btn--primary" onclick="exportJSON()">Download JSON</button>
                    </div>
                    
                    <div class="question-card" style="margin-top: var(--space-md);">
                        <h3 style="margin-bottom: var(--space-sm);">Import Data</h3>
                        <p style="margin-bottom: var(--space-md); color: var(--color-text-secondary);">
                            Import previously exported data.
                        </p>
                        <input type="file" id="import-file" accept=".json" onchange="importJSON(event)" />
                    </div>
                </div>
            </div>
            
            <!-- Topic Requests View -->
            <div id="view-topics" class="view hidden">
                <header class="header">
                    <h1>Topic Requests</h1>
                    <div class="header-actions">
                        <span id="topic-stats" style="color: var(--color-text-muted); font-size: 0.9rem;"></span>
                    </div>
                </header>
                <div class="content">
                    <div class="section-intro" style="margin-bottom: var(--space-lg);">
                        <p style="color: var(--color-text-secondary);">
                            Topics submitted by visitors on REACH Access. Review these to identify content gaps and create new articles.
                        </p>
                    </div>
                    
                    <div class="filters" style="margin-bottom: var(--space-lg);">
                        <button class="filter-btn active" data-topic-filter="all" onclick="filterTopics('all')">All</button>
                        <button class="filter-btn" data-topic-filter="new" onclick="filterTopics('new')">New</button>
                        <button class="filter-btn" data-topic-filter="reviewed" onclick="filterTopics('reviewed')">Reviewed</button>
                        <button class="filter-btn" data-topic-filter="converted" onclick="filterTopics('converted')">Converted to Article</button>
                    </div>
                    
                    <div id="topics-list" class="articles-list">
                        <!-- Topic requests rendered here -->
                    </div>
                </div>
            </div>
            
            <!-- Relocation Intake View -->
            <div id="view-relocation-intake" class="view hidden">
                <header class="header">
                    <h1>New Relocation Request</h1>
                </header>
                <div class="content">
                    <div class="section-intro" style="margin-bottom: var(--space-lg);">
                        <p style="color: var(--color-text-secondary);">
                            Capture relocation requests from trainees. When they buy a home through our referral network, the referral fee funds REACH fellowships.
                        </p>
                    </div>
                    
                    <form id="relocation-form" class="survey-form">
                        <!-- Trainee Info -->
                        <div class="question-card">
                            <h3>Trainee Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Full Name *</label>
                                    <input type="text" id="relo-name" required />
                                </div>
                                <div class="form-group">
                                    <label>Email *</label>
                                    <input type="email" id="relo-email" required />
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Phone</label>
                                    <input type="tel" id="relo-phone" />
                                </div>
                                <div class="form-group">
                                    <label>Current Role</label>
                                    <select id="relo-role">
                                        <option value="">Select...</option>
                                        <option value="medical-student">Medical Student</option>
                                        <option value="resident">Resident</option>
                                        <option value="fellow">Fellow</option>
                                        <option value="attending">Attending/Faculty</option>
                                        <option value="other">Other Healthcare Professional</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Current Institution</label>
                                <input type="text" id="relo-current-institution" placeholder="e.g., Emory University" />
                            </div>
                        </div>
                        
                        <!-- Move Details -->
                        <div class="question-card">
                            <h3>Move Details</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Moving From (City, State) *</label>
                                    <input type="text" id="relo-from" required placeholder="e.g., Atlanta, GA" />
                                </div>
                                <div class="form-group">
                                    <label>Moving To (City, State) *</label>
                                    <input type="text" id="relo-to" required placeholder="e.g., San Francisco, CA" />
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Target Move Date</label>
                                    <input type="date" id="relo-date" />
                                </div>
                                <div class="form-group">
                                    <label>Reason for Move</label>
                                    <select id="relo-reason">
                                        <option value="">Select...</option>
                                        <option value="residency-match">Residency Match</option>
                                        <option value="fellowship">Fellowship</option>
                                        <option value="attending-position">Attending/Faculty Position</option>
                                        <option value="spouse-job">Spouse/Partner Job</option>
                                        <option value="personal">Personal Reasons</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>New Institution/Employer</label>
                                <input type="text" id="relo-new-institution" placeholder="e.g., UCSF Medical Center" />
                            </div>
                        </div>
                        
                        <!-- Housing Needs -->
                        <div class="question-card">
                            <h3>Housing Needs</h3>
                            <div class="form-group">
                                <label>What are you looking for?</label>
                                <div class="checkbox-grid">
                                    <label class="checkbox-item">
                                        <input type="radio" name="relo-type" value="buy" />
                                        <span> Buying a Home</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="radio" name="relo-type" value="rent" />
                                        <span> Renting</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="radio" name="relo-type" value="unsure" />
                                        <span> Not Sure Yet</span>
                                    </label>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Budget Range</label>
                                    <select id="relo-budget">
                                        <option value="">Select...</option>
                                        <option value="under-200k">Under $200,000</option>
                                        <option value="200k-400k">$200,000 - $400,000</option>
                                        <option value="400k-600k">$400,000 - $600,000</option>
                                        <option value="600k-800k">$600,000 - $800,000</option>
                                        <option value="800k-1m">$800,000 - $1,000,000</option>
                                        <option value="over-1m">Over $1,000,000</option>
                                        <option value="rent-under-2k">Rent: Under $2,000/mo</option>
                                        <option value="rent-2k-3k">Rent: $2,000 - $3,000/mo</option>
                                        <option value="rent-over-3k">Rent: Over $3,000/mo</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Pre-approved for Mortgage?</label>
                                    <select id="relo-preapproved">
                                        <option value="">Select...</option>
                                        <option value="yes">Yes</option>
                                        <option value="no">No</option>
                                        <option value="in-progress">In Progress</option>
                                        <option value="na">N/A (Renting)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Special Requirements or Preferences</label>
                                <textarea id="relo-preferences" rows="3" placeholder="e.g., Need to be near hospital, good schools, pet-friendly, etc."></textarea>
                            </div>
                        </div>
                        
                        <!-- Timeline & Urgency -->
                        <div class="question-card">
                            <h3>Timeline & Services</h3>
                            <div class="form-group">
                                <label>How soon do you need help?</label>
                                <select id="relo-urgency">
                                    <option value="">Select...</option>
                                    <option value="asap">ASAP - Moving very soon</option>
                                    <option value="1-2-months">1-2 months</option>
                                    <option value="3-6-months">3-6 months</option>
                                    <option value="6-plus-months">6+ months (planning ahead)</option>
                                    <option value="just-exploring">Just exploring options</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>What services would help you?</label>
                                <div class="checkbox-grid">
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="relo-services" value="buyer-agent" />
                                        <span>Buyer's Agent</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="relo-services" value="rental-agent" />
                                        <span>Rental Agent</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="relo-services" value="mortgage" />
                                        <span>Mortgage Lender</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="relo-services" value="moving" />
                                        <span>Moving Company</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="relo-services" value="area-info" />
                                        <span>Area Information</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="relo-services" value="selling" />
                                        <span>Selling Current Home</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- How They Found Us -->
                        <div class="question-card">
                            <h3>Referral Source</h3>
                            <div class="form-group">
                                <label>How did they hear about REACH?</label>
                                <select id="relo-source">
                                    <option value="">Select...</option>
                                    <option value="reach-access">REACH Access (website)</option>
                                    <option value="fellow">REACH Fellow</option>
                                    <option value="colleague">Colleague/Word of mouth</option>
                                    <option value="program-office">Program Office</option>
                                    <option value="social-media">Social Media</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Notes</label>
                                <textarea id="relo-notes" rows="2" placeholder="Any additional context..."></textarea>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn--secondary" onclick="clearRelocationForm()">Clear</button>
                            <button type="submit" class="btn btn--primary" onclick="saveRelocation(event)">Save Request</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- All Relocations View -->
            <div id="view-relocations" class="view hidden">
                <header class="header">
                    <h1>Relocation Requests</h1>
                    <div class="header-actions">
                        <span id="relo-stats" style="color: var(--color-text-muted); font-size: 0.9rem;"></span>
                    </div>
                </header>
                <div class="content">
                    <!-- Pipeline Stats -->
                    <div class="pipeline-stats" style="margin-bottom: var(--space-lg);">
                        <div class="pipeline-stat" id="stat-new">
                            <div class="pipeline-stat-value">0</div>
                            <div class="pipeline-stat-label">New</div>
                        </div>
                        <div class="pipeline-arrow"></div>
                        <div class="pipeline-stat" id="stat-contacted">
                            <div class="pipeline-stat-value">0</div>
                            <div class="pipeline-stat-label">Contacted</div>
                        </div>
                        <div class="pipeline-arrow"></div>
                        <div class="pipeline-stat" id="stat-matched">
                            <div class="pipeline-stat-value">0</div>
                            <div class="pipeline-stat-label">Agent Matched</div>
                        </div>
                        <div class="pipeline-arrow"></div>
                        <div class="pipeline-stat" id="stat-active">
                            <div class="pipeline-stat-value">0</div>
                            <div class="pipeline-stat-label">Active Search</div>
                        </div>
                        <div class="pipeline-arrow"></div>
                        <div class="pipeline-stat" id="stat-closed">
                            <div class="pipeline-stat-value">0</div>
                            <div class="pipeline-stat-label">Closed</div>
                        </div>
                    </div>
                    
                    <!-- Revenue Tracker -->
                    <div class="revenue-tracker" style="margin-bottom: var(--space-lg);">
                        <div class="revenue-card">
                            <div class="revenue-label">Potential Revenue</div>
                            <div class="revenue-value" id="revenue-potential">$0</div>
                            <div class="revenue-note">Based on active pipeline</div>
                        </div>
                        <div class="revenue-card revenue-card--earned">
                            <div class="revenue-label">Revenue Earned</div>
                            <div class="revenue-value" id="revenue-earned">$0</div>
                            <div class="revenue-note">From closed transactions</div>
                        </div>
                    </div>
                    
                    <!-- Filters -->
                    <div class="filters" style="margin-bottom: var(--space-lg);">
                        <button class="filter-btn active" data-relo-filter="all" onclick="filterRelocations('all')">All</button>
                        <button class="filter-btn" data-relo-filter="new" onclick="filterRelocations('new')">New</button>
                        <button class="filter-btn" data-relo-filter="contacted" onclick="filterRelocations('contacted')">Contacted</button>
                        <button class="filter-btn" data-relo-filter="matched" onclick="filterRelocations('matched')">Agent Matched</button>
                        <button class="filter-btn" data-relo-filter="active" onclick="filterRelocations('active')">Active Search</button>
                        <button class="filter-btn" data-relo-filter="closed" onclick="filterRelocations('closed')">Closed</button>
                    </div>
                    
                    <!-- Relocations List -->
                    <div id="relocations-list" class="relocations-list">
                        <!-- Relocations rendered here -->
                    </div>
                </div>
            </div>
            
            <!-- Add Sponsor View -->
            <div id="view-new-sponsor" class="view hidden">
                <header class="header">
                    <h1>Add New Sponsor</h1>
                </header>
                <div class="content">
                    <form id="sponsor-form" class="survey-form">
                        <!-- Basic Info -->
                        <div class="question-card">
                            <h3>Sponsor Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Company/Business Name *</label>
                                    <input type="text" id="sponsor-company" required />
                                </div>
                                <div class="form-group">
                                    <label>Contact Name *</label>
                                    <input type="text" id="sponsor-contact" required />
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Email *</label>
                                    <input type="email" id="sponsor-email" required />
                                </div>
                                <div class="form-group">
                                    <label>Phone</label>
                                    <input type="tel" id="sponsor-phone" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Website</label>
                                <input type="url" id="sponsor-website" placeholder="https://" />
                            </div>
                        </div>
                        
                        <!-- Service Category -->
                        <div class="question-card">
                            <h3>Service Category</h3>
                            <p class="question-help">What type of services does this sponsor provide?</p>
                            <div class="checkbox-grid">
                                <label class="checkbox-item">
                                    <input type="checkbox" name="sponsor-category" value="real-estate" />
                                    <span> Real Estate</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="sponsor-category" value="mortgage" />
                                    <span> Mortgage/Lending</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="sponsor-category" value="financial" />
                                    <span> Financial Planning</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="sponsor-category" value="insurance" />
                                    <span> Insurance</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="sponsor-category" value="legal" />
                                    <span> Legal Services</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="sponsor-category" value="moving" />
                                    <span> Moving Services</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="sponsor-category" value="tax" />
                                    <span> Tax/Accounting</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="sponsor-category" value="career" />
                                    <span> Career Services</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="sponsor-category" value="wellness" />
                                    <span> Wellness/Coaching</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="sponsor-category" value="other" />
                                    <span> Other</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Service Details -->
                        <div class="question-card">
                            <h3>Services Offered</h3>
                            <div class="form-group">
                                <label>Describe the specific services they offer to medical trainees</label>
                                <textarea id="sponsor-services" rows="3" placeholder="e.g., Physician mortgage loans with 0% down, no PMI..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Geographic Coverage</label>
                                <input type="text" id="sponsor-geography" placeholder="e.g., Atlanta metro, Georgia statewide, National" />
                            </div>
                            <div class="form-group">
                                <label>Special Offers for REACH Trainees (if any)</label>
                                <textarea id="sponsor-offers" rows="2" placeholder="e.g., Waived application fee, free consultation..."></textarea>
                            </div>
                        </div>
                        
                        <!-- Target Audience -->
                        <div class="question-card">
                            <h3>Target Audience</h3>
                            <p class="question-help">Which trainees would benefit most from this sponsor's services?</p>
                            <div class="checkbox-grid">
                                <label class="checkbox-item">
                                    <input type="checkbox" name="sponsor-audience" value="medical-student" />
                                    <span>Medical Students</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="sponsor-audience" value="resident" />
                                    <span>Residents</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="sponsor-audience" value="fellow" />
                                    <span>Fellows</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="sponsor-audience" value="early-faculty" />
                                    <span>Early Faculty</span>
                                </label>
                            </div>
                            <div class="form-group" style="margin-top: var(--space-md);">
                                <label>Relevant Life Events (when would trainees need this service?)</label>
                                <div class="checkbox-grid">
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="sponsor-events" value="relocating" />
                                        <span>Relocating</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="sponsor-events" value="buying-home" />
                                        <span>Buying a Home</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="sponsor-events" value="starting-training" />
                                        <span>Starting Training</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="sponsor-events" value="finishing-training" />
                                        <span>Finishing Training</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="sponsor-events" value="job-searching" />
                                        <span>Job Searching</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="sponsor-events" value="loan-repayment" />
                                        <span>Loan Repayment</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="sponsor-events" value="contract-review" />
                                        <span>Contract Review</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="sponsor-events" value="burnout" />
                                        <span>Burnout/Stress</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Marketing Preferences -->
                        <div class="question-card">
                            <h3>Marketing Preferences</h3>
                            <div class="form-group">
                                <label>Preferred Content Style</label>
                                <select id="sponsor-content-style">
                                    <option value="">Select...</option>
                                    <option value="educational">Educational (how-to guides, tips)</option>
                                    <option value="story-driven">Story-driven (testimonials, case studies)</option>
                                    <option value="data-driven">Data-driven (statistics, comparisons)</option>
                                    <option value="promotional">Promotional (offers, discounts)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Preferred Channels</label>
                                <div class="checkbox-grid">
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="sponsor-channels" value="wiki" />
                                        <span>REACH Access Wiki</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="sponsor-channels" value="email" />
                                        <span>Email Newsletter</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="sponsor-channels" value="events" />
                                        <span>Events/Workshops</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="sponsor-channels" value="referral" />
                                        <span>Direct Referrals</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Sponsorship Status -->
                        <div class="question-card">
                            <h3>Sponsorship Status</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Status</label>
                                    <select id="sponsor-status">
                                        <option value="prospect">Prospect (not yet committed)</option>
                                        <option value="pending">Pending (in discussions)</option>
                                        <option value="active">Active Sponsor</option>
                                        <option value="paused">Paused</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Monthly Contribution</label>
                                    <input type="number" id="sponsor-contribution" placeholder="200" min="0" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Notes</label>
                                <textarea id="sponsor-notes" rows="2" placeholder="Any additional notes about this sponsor relationship..."></textarea>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn--secondary" onclick="clearSponsorForm()">Clear</button>
                            <button type="submit" class="btn btn--primary" onclick="saveSponsor(event)">Save Sponsor</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Marketing Needs Discovery View -->
            <div id="view-sponsor-needs" class="view hidden">
                <header class="header">
                    <h1>Marketing Needs Discovery</h1>
                    <div class="header-actions">
                        <button class="btn btn--primary" onclick="showNewNeedsForm()">+ New Entry</button>
                    </div>
                </header>
                <div class="content">
                    <div class="section-intro" style="margin-bottom: var(--space-lg);">
                        <p style="color: var(--color-text-secondary);">
                            Capture what sponsors and potential sponsors actually need. Use this during discovery calls and interviews to understand what would make REACH valuable to them.
                        </p>
                    </div>
                    
                    <!-- New Entry Form (hidden by default) -->
                    <div id="needs-form-container" class="question-card" style="display: none; margin-bottom: var(--space-lg);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-md);">
                            <h3>New Discovery Entry</h3>
                            <button class="btn btn--secondary" onclick="hideNeedsForm()" style="padding: 0.25rem 0.5rem;"></button>
                        </div>
                        
                        <form id="sponsor-needs-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Company/Person Name *</label>
                                    <input type="text" id="needs-company" required placeholder="Who did you talk to?" />
                                </div>
                                <div class="form-group">
                                    <label>Their Role/Business Type</label>
                                    <input type="text" id="needs-role" placeholder="e.g., Real estate agent, Financial advisor" />
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Date of Conversation</label>
                                <input type="date" id="needs-date" />
                            </div>
                            
                            <div class="form-group">
                                <label>What are they trying to achieve? (Their goals)</label>
                                <textarea id="needs-goals" rows="3" placeholder="What do they want? More clients? Brand awareness? Access to physicians?"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>What problems/frustrations do they have? (Pain points)</label>
                                <textarea id="needs-pains" rows="3" placeholder="What's hard for them? What are they struggling with?"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>What would make them say yes to sponsoring? (Value proposition)</label>
                                <textarea id="needs-value" rows="3" placeholder="What would they pay for? What would make this worth it?"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>What objections or concerns did they raise?</label>
                                <textarea id="needs-objections" rows="3" placeholder="Why might they say no? What worried them?"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>How do they currently reach medical trainees?</label>
                                <textarea id="needs-current" rows="2" placeholder="What marketing are they doing now?"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Budget/Willingness to pay</label>
                                <textarea id="needs-budget" rows="2" placeholder="Any signals about budget? What do they pay for similar things?"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Specific features/services they asked about</label>
                                <textarea id="needs-features" rows="2" placeholder="Did they ask for specific things? Leads? Content? Events?"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Quotes / Notable things they said</label>
                                <textarea id="needs-quotes" rows="2" placeholder="Any memorable quotes or phrases they used?"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Your takeaways / Ideas this sparked</label>
                                <textarea id="needs-takeaways" rows="3" placeholder="What did you learn? What should we build or offer?"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Next steps with this person</label>
                                <textarea id="needs-next" rows="2" placeholder="Follow up? Send proposal? Check back later?"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Tags (comma-separated)</label>
                                <input type="text" id="needs-tags" placeholder="e.g., real-estate, high-potential, needs-follow-up" />
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn--secondary" onclick="hideNeedsForm()">Cancel</button>
                                <button type="submit" class="btn btn--primary" onclick="saveNeedsEntry(event)">Save Entry</button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Entries List -->
                    <div id="needs-entries-list" class="needs-entries-list">
                        <!-- Entries rendered here -->
                    </div>
                    
                    <!-- Insights Summary -->
                    <div id="needs-insights" class="needs-insights" style="margin-top: var(--space-xl);">
                        <h3>Emerging Patterns</h3>
                        <p class="panel-subtitle">Themes across all discovery conversations</p>
                        <div id="insights-content" class="insights-grid">
                            <!-- Insights rendered here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- All Sponsors View -->
            <div id="view-sponsors" class="view hidden">
                <header class="header">
                    <h1>All Sponsors</h1>
                    <div class="header-actions">
                        <span id="sponsor-stats" style="color: var(--color-text-muted); font-size: 0.9rem;"></span>
                    </div>
                </header>
                <div class="content">
                    <div class="filters" style="margin-bottom: var(--space-lg);">
                        <button class="filter-btn active" data-sponsor-filter="all" onclick="filterSponsors('all')">All</button>
                        <button class="filter-btn" data-sponsor-filter="active" onclick="filterSponsors('active')">Active</button>
                        <button class="filter-btn" data-sponsor-filter="pending" onclick="filterSponsors('pending')">Pending</button>
                        <button class="filter-btn" data-sponsor-filter="prospect" onclick="filterSponsors('prospect')">Prospects</button>
                    </div>
                    
                    <div id="sponsors-list" class="sponsors-grid">
                        <!-- Sponsors rendered here -->
                    </div>
                </div>
            </div>
            
            <!-- Needs Matching View -->
            <div id="view-matching" class="view hidden">
                <header class="header">
                    <h1>Needs Matching</h1>
                </header>
                <div class="content">
                    <div class="section-intro" style="margin-bottom: var(--space-lg);">
                        <p style="color: var(--color-text-secondary);">
                            Match trainee needs from surveys with sponsor services. This helps identify which sponsors can help which trainees.
                        </p>
                    </div>
                    
                    <div class="matching-layout">
                        <div class="matching-panel">
                            <h3>Trainee Needs</h3>
                            <p class="panel-subtitle">Extracted from survey responses</p>
                            <div id="trainee-needs-list" class="needs-list">
                                <!-- Trainee needs rendered here -->
                            </div>
                        </div>
                        
                        <div class="matching-panel">
                            <h3>Sponsor Services</h3>
                            <p class="panel-subtitle">Available from active sponsors</p>
                            <div id="sponsor-services-list" class="services-list">
                                <!-- Sponsor services rendered here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="matching-suggestions" style="margin-top: var(--space-xl);">
                        <h3>Suggested Matches</h3>
                        <div id="match-suggestions" class="match-suggestions-grid">
                            <!-- Match suggestions rendered here -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    <!-- Response Detail Modal -->
    <div id="response-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modal-title">Response Details</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Response details will be rendered here -->
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // AUTHENTICATION
        // ============================================
        
        // Demo credentials (in production, this would be server-side auth)
        const ADMIN_CREDENTIALS = {
            email: 'admin@reachpartnerships.org',
            password: 'reach2025'
        };
        
        // Check if already logged in (session or remembered)
        document.addEventListener('DOMContentLoaded', () => {
            checkAuthStatus();
        });
        
        function checkAuthStatus() {
            // Check for remembered login first (localStorage persists)
            const rememberedLogin = localStorage.getItem('reach_admin_remembered');
            const rememberedExpiry = localStorage.getItem('reach_admin_expiry');
            
            if (rememberedLogin === 'true' && rememberedExpiry) {
                const expiryDate = new Date(rememberedExpiry);
                if (new Date() < expiryDate) {
                    // Still valid, auto-login
                    showApp();
                    return;
                } else {
                    // Expired, clear it
                    localStorage.removeItem('reach_admin_remembered');
                    localStorage.removeItem('reach_admin_expiry');
                }
            }
            
            // Check session storage (current tab only)
            const isLoggedIn = sessionStorage.getItem('reach_admin_logged_in');
            if (isLoggedIn === 'true') {
                showApp();
            }
        }
        
        // ============================================
        // SCREEN NAVIGATION
        // ============================================
        
        function showLandingScreen() {
            document.getElementById('landing-screen').classList.remove('hidden');
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('fellow-login-screen').classList.add('hidden');
            document.getElementById('fellow-portal').classList.add('hidden');
            document.getElementById('sponsor-portal').classList.add('hidden');
            document.getElementById('main-app').classList.add('hidden');
        }
        
        function showLoginScreen() {
            document.getElementById('landing-screen').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('fellow-login-screen').classList.add('hidden');
            document.getElementById('fellow-portal').classList.add('hidden');
            document.getElementById('sponsor-portal').classList.add('hidden');
            document.getElementById('main-app').classList.add('hidden');
        }
        
        function showSponsorPortal() {
            document.getElementById('landing-screen').classList.add('hidden');
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('fellow-login-screen').classList.add('hidden');
            document.getElementById('fellow-portal').classList.add('hidden');
            document.getElementById('sponsor-portal').classList.remove('hidden');
            document.getElementById('main-app').classList.add('hidden');
            
            // Reset form
            document.getElementById('public-sponsor-form').reset();
            document.getElementById('public-sponsor-form').classList.remove('hidden');
            document.getElementById('sponsor-form-success').classList.add('hidden');
        }
        
        // ============================================
        // FELLOW PORTAL
        // ============================================
        
        // Registered fellows (admin adds these via REACH Exchange Admin)
        // In production, Firebase Auth will handle this
        let currentFellow = null;
        
        function getRegisteredFellows() {
            const fellows = JSON.parse(localStorage.getItem('reach_registered_fellows') || '[]');
            // Add demo fellows if none exist
            if (fellows.length === 0) {
                const demoFellows = [
                    { id: 1, email: 'fellow1@emory.edu', name: 'Dr. Sarah Chen' },
                    { id: 2, email: 'fellow2@emory.edu', name: 'Dr. James Williams' }
                ];
                localStorage.setItem('reach_registered_fellows', JSON.stringify(demoFellows));
                return demoFellows;
            }
            return fellows;
        }
        
        function showFellowLogin() {
            document.getElementById('landing-screen').classList.add('hidden');
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('fellow-login-screen').classList.remove('hidden');
            document.getElementById('fellow-portal').classList.add('hidden');
            document.getElementById('sponsor-portal').classList.add('hidden');
            document.getElementById('main-app').classList.add('hidden');
            
            // Reset form
            document.getElementById('fellow-login-email').value = '';
            document.getElementById('fellow-login-error').classList.add('hidden');
        }
        
        function showComingSoon() {
            alert('Social login coming soon!\n\nFor now, use your registered email below.');
        }
        
        function handleFellowEmailLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('fellow-login-email').value.toLowerCase().trim();
            const errorEl = document.getElementById('fellow-login-error');
            const fellows = getRegisteredFellows();
            
            const fellow = fellows.find(f => f.email.toLowerCase() === email);
            
            if (fellow) {
                // Success - fellow is on whitelist
                currentFellow = fellow;
                sessionStorage.setItem('reach_fellow_id', fellow.id);
                sessionStorage.setItem('reach_fellow_name', fellow.name);
                sessionStorage.setItem('reach_fellow_email', fellow.email);
                
                errorEl.classList.add('hidden');
                showFellowPortal();
            } else {
                // Not registered
                errorEl.classList.remove('hidden');
                document.querySelector('#fellow-login-screen .login-card').style.animation = 'shake 0.5s ease';
                setTimeout(() => {
                    document.querySelector('#fellow-login-screen .login-card').style.animation = '';
                }, 500);
            }
        }
        
        function handleFellowLogout() {
            currentFellow = null;
            sessionStorage.removeItem('reach_fellow_id');
            sessionStorage.removeItem('reach_fellow_name');
            sessionStorage.removeItem('reach_fellow_email');
            showLandingScreen();
        }
        
        function showFellowPortal() {
            document.getElementById('landing-screen').classList.add('hidden');
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('fellow-login-screen').classList.add('hidden');
            document.getElementById('fellow-portal').classList.remove('hidden');
            document.getElementById('sponsor-portal').classList.add('hidden');
            document.getElementById('main-app').classList.add('hidden');
            
            // Show fellow name
            const fellowName = sessionStorage.getItem('reach_fellow_name') || 'Fellow';
            document.getElementById('fellow-name-display').textContent = fellowName;
            
            // Load fellow data
            loadFellowDashboard();
        }
        
        function loadFellowDashboard() {
            const fellowId = sessionStorage.getItem('reach_fellow_id');
            
            // Check survey status
            const surveyData = localStorage.getItem(`reach_fellow_survey_${fellowId}`);
            const surveyStatus = document.getElementById('survey-status');
            const surveyBtn = document.getElementById('survey-action-btn');
            
            if (surveyData) {
                const survey = JSON.parse(surveyData);
                if (survey.submitted) {
                    surveyStatus.textContent = 'Completed ';
                    surveyStatus.classList.add('progress-status--complete');
                    surveyBtn.textContent = 'View Responses';
                } else {
                    surveyStatus.textContent = 'In progress';
                    surveyStatus.classList.add('progress-status--pending');
                    surveyBtn.textContent = 'Continue';
                }
            } else {
                surveyStatus.textContent = 'Not started';
                surveyBtn.textContent = 'Start Survey';
            }
            
            // Check weekly check-in status
            const checkins = JSON.parse(localStorage.getItem(`reach_fellow_checkins_${fellowId}`) || '[]');
            const checkinStatus = document.getElementById('checkin-status');
            const checkinBtn = document.getElementById('checkin-action-btn');
            
            const thisWeek = getWeekNumber(new Date());
            const lastCheckin = checkins[0];
            const lastCheckinWeek = lastCheckin ? getWeekNumber(new Date(lastCheckin.date)) : null;
            
            if (lastCheckinWeek === thisWeek) {
                checkinStatus.textContent = 'Completed this week ';
                checkinStatus.classList.add('progress-status--complete');
                checkinBtn.textContent = 'View';
            } else {
                checkinStatus.textContent = 'Due this week';
                checkinStatus.classList.remove('progress-status--complete');
                checkinBtn.textContent = 'Check In';
            }
            
            // Load check-in history
            loadCheckinHistory();
            
            // Hide sections, show dashboard
            document.getElementById('fellow-survey-section').classList.add('hidden');
            document.getElementById('fellow-checkin-section').classList.add('hidden');
        }
        
        function getWeekNumber(date) {
            const start = new Date(date.getFullYear(), 0, 1);
            const diff = date - start;
            const oneWeek = 604800000;
            return Math.floor(diff / oneWeek);
        }
        
        // Fellow Survey
        const FELLOW_QUESTIONS = [
            { id: 'q1', label: 'Q1: Problem Definition & Scientific Rationale', hint: 'What is the scientific problem or unresolved clinical/operational question you aim to address? What preliminary evidence suggests this problem is important? What gap in the literature, methodology, or practice does this project fill?' },
            { id: 'q2', label: 'Q2: Disciplinary Foundations & Theoretical Framework', hint: 'Which scientific disciplines, fields, or methodological traditions inform this problem? What conceptual or theoretical frameworks will guide your research question?' },
            { id: 'q3', label: 'Q3: Institutional & Mentorship Environment', hint: 'Which departments, faculty mentors, and research environments align with your proposed project? What unique resources, cores, datasets, or learning environments support your training plan?' },
            { id: 'q4', label: 'Q4: Population & Phenotype Definition', hint: 'Who or what is the target of study? Describe the population, group, system, workflow, or mechanism your project examines.' },
            { id: 'q5', label: 'Q5: Community, Clinical, and Nonprofit Partners', hint: 'Which community organizations, advocacy groups, clinical partners, or nonprofits interact with the population or domain you plan to study?' },
            { id: 'q6', label: 'Q6: Clinical & Workforce Stakeholders', hint: 'Which clinical departments, operational groups, or health-system actors intersect with your research problem?' },
            { id: 'q7', label: 'Q7: Industry, Technology, and Innovation Landscape', hint: 'Which for-profit organizations, companies, platforms, or technologies relate to your research topic?' },
            { id: 'q8', label: 'Q8: Regulatory, Ethical, and Policy Considerations', hint: 'What institutional policies, compliance considerations, or regulatory frameworks govern your project? (e.g., IRB, HIPAA, ACGME)' },
            { id: 'q9', label: 'Q9: Feasibility, Barriers, and Practical Constraints', hint: 'What logistical, technical, financial, or operational constraints could affect your pilot data collection? What is feasible for a 1-year pilot phase?' },
            { id: 'q10', label: 'Q10: Existing Methods, Measures, and Tools', hint: 'What validated tools, datasets, measurement strategies, or analytic methods already exist for studying this problem?' },
            { id: 'q11', label: 'Q11: Stakeholder Priorities & NIH Fit', hint: 'How does your proposed project align with your NIH institute\'s mission, career development priorities, and future R01 trajectory?' },
            { id: 'q12', label: 'Q12: Funding Mechanisms & Next-Step Trajectory', hint: 'What future funding pathways does this project lead into? What preliminary data would you need to secure a full K-award?' },
            { id: 'q13', label: 'Q13: Technical Implementation', hint: 'What systems, software, or infrastructure will your research require or produce? What data types will you handle? (PHI, PII, genomic, etc.)' },
            { id: 'q14', label: 'Q14: Security & Privacy Considerations', hint: 'What security or privacy concerns exist for your project? What compliance requirements apply? Would you benefit from a security architecture review?' }
        ];
        
        function showFellowSurvey() {
            document.getElementById('fellow-survey-section').classList.remove('hidden');
            document.getElementById('fellow-checkin-section').classList.add('hidden');
            renderFellowSurveyQuestions();
        }
        
        function hideFellowSurvey() {
            document.getElementById('fellow-survey-section').classList.add('hidden');
            loadFellowDashboard();
        }
        
        function renderFellowSurveyQuestions() {
            const container = document.getElementById('fellow-questions-container');
            const fellowId = sessionStorage.getItem('reach_fellow_id');
            const savedData = JSON.parse(localStorage.getItem(`reach_fellow_survey_${fellowId}`) || '{}');
            
            container.innerHTML = FELLOW_QUESTIONS.map(q => `
                <div class="question-card">
                    <label class="question-label">${q.label}</label>
                    <p class="question-hint">${q.hint}</p>
                    <textarea id="fellow-${q.id}" rows="4" onchange="updateSurveyProgress()">${savedData[q.id] || ''}</textarea>
                </div>
            `).join('');
            
            updateSurveyProgress();
        }
        
        function updateSurveyProgress() {
            let answered = 0;
            FELLOW_QUESTIONS.forEach(q => {
                const val = document.getElementById(`fellow-${q.id}`)?.value?.trim();
                if (val && val.length > 10) answered++;
            });
            
            document.getElementById('questions-answered').textContent = answered;
            document.getElementById('survey-progress-fill').style.width = `${(answered / 14) * 100}%`;
        }
        
        function saveFellowSurveyDraft() {
            const fellowId = sessionStorage.getItem('reach_fellow_id');
            const data = { submitted: false };
            
            FELLOW_QUESTIONS.forEach(q => {
                data[q.id] = document.getElementById(`fellow-${q.id}`)?.value || '';
            });
            
            localStorage.setItem(`reach_fellow_survey_${fellowId}`, JSON.stringify(data));
            alert('Draft saved!');
        }
        
        function submitFellowSurvey(event) {
            event.preventDefault();
            
            const fellowId = sessionStorage.getItem('reach_fellow_id');
            const fellowName = sessionStorage.getItem('reach_fellow_name');
            const data = { submitted: true, submittedAt: new Date().toISOString() };
            
            FELLOW_QUESTIONS.forEach(q => {
                data[q.id] = document.getElementById(`fellow-${q.id}`)?.value || '';
            });
            
            // Check if enough answered
            let answered = 0;
            FELLOW_QUESTIONS.forEach(q => {
                if (data[q.id]?.trim().length > 10) answered++;
            });
            
            if (answered < 10) {
                alert('Please answer at least 10 questions before submitting.');
                return;
            }
            
            // Save to fellow's storage
            localStorage.setItem(`reach_fellow_survey_${fellowId}`, JSON.stringify(data));
            
            // Also save to admin responses (for REACH Exchange)
            const adminResponses = JSON.parse(localStorage.getItem('reach_survey_responses') || '[]');
            adminResponses.push({
                id: Date.now(),
                type: '14-question',
                respondent: fellowName,
                fellowId: fellowId,
                submittedAt: new Date().toISOString(),
                responses: data
            });
            localStorage.setItem('reach_survey_responses', JSON.stringify(adminResponses));
            
            alert('Survey submitted successfully! Thank you.');
            hideFellowSurvey();
        }
        
        // Weekly Check-in
        function showWeeklyCheckin() {
            document.getElementById('fellow-survey-section').classList.add('hidden');
            document.getElementById('fellow-checkin-section').classList.remove('hidden');
            document.getElementById('fellow-checkin-form').reset();
        }
        
        function hideWeeklyCheckin() {
            document.getElementById('fellow-checkin-section').classList.add('hidden');
            loadFellowDashboard();
        }
        
        function submitWeeklyCheckin(event) {
            event.preventDefault();
            
            const fellowId = sessionStorage.getItem('reach_fellow_id');
            const fellowName = sessionStorage.getItem('reach_fellow_name');
            
            const progressRating = document.querySelector('input[name="progress-rating"]:checked')?.value;
            const wellbeingRating = document.querySelector('input[name="wellbeing-rating"]:checked')?.value;
            const needs = Array.from(document.querySelectorAll('input[name="checkin-needs"]:checked')).map(c => c.value);
            
            if (!progressRating) {
                alert('Please rate your progress this week.');
                return;
            }
            
            const checkin = {
                id: Date.now(),
                date: new Date().toISOString(),
                progressRating: parseInt(progressRating),
                accomplishments: document.getElementById('checkin-accomplishments').value,
                barriers: document.getElementById('checkin-barriers').value,
                needs: needs,
                needsOther: document.getElementById('checkin-needs-other').value,
                wellbeingRating: wellbeingRating ? parseInt(wellbeingRating) : null,
                other: document.getElementById('checkin-other').value
            };
            
            // Save to fellow's check-in history
            const checkins = JSON.parse(localStorage.getItem(`reach_fellow_checkins_${fellowId}`) || '[]');
            checkins.unshift(checkin);
            localStorage.setItem(`reach_fellow_checkins_${fellowId}`, JSON.stringify(checkins));
            
            // Also save to admin responses
            const adminResponses = JSON.parse(localStorage.getItem('reach_survey_responses') || '[]');
            adminResponses.push({
                id: Date.now(),
                type: 'weekly-checkin',
                respondent: fellowName,
                fellowId: fellowId,
                submittedAt: new Date().toISOString(),
                responses: checkin
            });
            localStorage.setItem('reach_survey_responses', JSON.stringify(adminResponses));
            
            alert('Check-in submitted! Thank you.');
            hideWeeklyCheckin();
        }
        
        function loadCheckinHistory() {
            const fellowId = sessionStorage.getItem('reach_fellow_id');
            const checkins = JSON.parse(localStorage.getItem(`reach_fellow_checkins_${fellowId}`) || '[]');
            const container = document.getElementById('checkin-history-list');
            
            if (checkins.length === 0) {
                container.innerHTML = '<p style="color: var(--color-text-muted); font-size: 0.9rem;">No check-ins yet. Complete your first one above!</p>';
                return;
            }
            
            container.innerHTML = checkins.slice(0, 10).map(c => {
                const date = new Date(c.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                return `
                    <div class="checkin-history-item">
                        <span class="checkin-history-date">${date}</span>
                        <span class="checkin-history-rating">Progress: ${c.progressRating}/10</span>
                    </div>
                `;
            }).join('');
        }
        
        function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const rememberMe = document.getElementById('remember-me').checked;
            const errorEl = document.getElementById('login-error');
            
            // Check credentials
            if (email === ADMIN_CREDENTIALS.email && password === ADMIN_CREDENTIALS.password) {
                // Always set session storage
                sessionStorage.setItem('reach_admin_logged_in', 'true');
                
                // If remember me, also set localStorage with 30-day expiry
                if (rememberMe) {
                    const expiryDate = new Date();
                    expiryDate.setDate(expiryDate.getDate() + 30);
                    localStorage.setItem('reach_admin_remembered', 'true');
                    localStorage.setItem('reach_admin_expiry', expiryDate.toISOString());
                }
                
                errorEl.classList.add('hidden');
                showApp();
            } else {
                errorEl.classList.remove('hidden');
                // Shake the login card
                document.querySelector('.login-card').style.animation = 'shake 0.5s ease';
                setTimeout(() => {
                    document.querySelector('.login-card').style.animation = '';
                }, 500);
            }
        }
        
        function handleLogout() {
            // Clear all auth storage
            sessionStorage.removeItem('reach_admin_logged_in');
            localStorage.removeItem('reach_admin_remembered');
            localStorage.removeItem('reach_admin_expiry');
            
            // Show landing screen (not login)
            showLandingScreen();
            
            // Clear form
            document.getElementById('login-email').value = '';
            document.getElementById('login-password').value = '';
            document.getElementById('remember-me').checked = false;
        }
        
        function showApp() {
            document.getElementById('landing-screen').classList.add('hidden');
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('fellow-login-screen').classList.add('hidden');
            document.getElementById('fellow-portal').classList.add('hidden');
            document.getElementById('sponsor-portal').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            initializeApp();
        }
        
        // ============================================
        // PUBLIC SPONSOR FORM
        // ============================================
        
        function submitPublicSponsorForm(event) {
            event.preventDefault();
            
            const categories = Array.from(document.querySelectorAll('input[name="pub-sponsor-category"]:checked')).map(c => c.value);
            
            if (categories.length === 0) {
                alert('Please select at least one service category.');
                return;
            }
            
            // Create sponsor record (matches REACH Exchange format)
            const sponsor = {
                id: Date.now(),
                company: document.getElementById('pub-sponsor-company').value,
                contact: document.getElementById('pub-sponsor-name').value,
                email: document.getElementById('pub-sponsor-email').value,
                phone: document.getElementById('pub-sponsor-phone').value,
                website: document.getElementById('pub-sponsor-website').value || '',
                categories: categories,
                services: document.getElementById('pub-sponsor-services').value || '',
                geography: document.getElementById('pub-sponsor-geography').value || '',
                offers: document.getElementById('pub-sponsor-offers').value || '',
                audiences: [],
                events: [],
                contentStyle: '',
                channels: [],
                status: 'prospect',
                contribution: 0,
                notes: `SELF-SUBMITTED via Sponsor Portal\n\nGoals: ${document.getElementById('pub-sponsor-goals').value || 'Not specified'}\n\nCurrent marketing: ${document.getElementById('pub-sponsor-current').value || 'Not specified'}\n\nChallenges: ${document.getElementById('pub-sponsor-challenges').value || 'Not specified'}\n\nBudget: ${document.getElementById('pub-sponsor-budget').value || 'Not specified'}\n\nSource: ${document.getElementById('pub-sponsor-source').value || 'Not specified'}\n\nAdditional notes: ${document.getElementById('pub-sponsor-notes').value || 'None'}`,
                source: 'sponsor-portal',
                createdAt: new Date().toISOString()
            };
            
            // Also create a marketing needs entry for discovery tracking
            const needsEntry = {
                id: Date.now() + 1,
                company: document.getElementById('pub-sponsor-company').value,
                role: categories.join(', ') || 'Not specified',
                date: new Date().toISOString().split('T')[0],
                goals: document.getElementById('pub-sponsor-goals').value || '',
                pains: document.getElementById('pub-sponsor-challenges').value || '',
                value: '',
                objections: '',
                current: document.getElementById('pub-sponsor-current').value || '',
                budget: document.getElementById('pub-sponsor-budget').value || '',
                features: '',
                quotes: '',
                takeaways: 'Self-submitted via Sponsor Portal. Review and schedule discovery call.',
                next: 'Review application and schedule call',
                tags: ['self-submitted', 'sponsor-portal', 'new-lead'],
                createdAt: new Date().toISOString()
            };
            
            // Save sponsor to localStorage
            const sponsors = JSON.parse(localStorage.getItem('reach_sponsors') || '[]');
            sponsors.unshift(sponsor);
            localStorage.setItem('reach_sponsors', JSON.stringify(sponsors));
            
            // Save to marketing needs
            const needs = JSON.parse(localStorage.getItem('reach_sponsor_needs') || '[]');
            needs.unshift(needsEntry);
            localStorage.setItem('reach_sponsor_needs', JSON.stringify(needs));
            
            // Show success
            document.getElementById('public-sponsor-form').classList.add('hidden');
            document.getElementById('sponsor-form-success').classList.remove('hidden');
        }
        
        function initializeApp() {
            renderQuestions();
            updateResponseCount();
            setupNavigation();
            setupSurveyToggle();
            setupFilters();
            updateSuggestionCount();
        }
        
        // ============================================
        // SURVEY SYSTEM
        // ============================================
        
        // Survey Questions Data
        const fullSurveyQuestions = [
            {
                id: 'q1',
                number: 'Q1',
                title: 'Problem Definition & Scientific Rationale',
                description: 'What is the scientific problem or unresolved clinical/operational question you aim to address? What preliminary evidence suggests this problem is important? What gap in the literature, methodology, or practice does this project fill?',
                placeholder: 'Describe the problem, its importance, and the gap you\'re addressing...'
            },
            {
                id: 'q2',
                number: 'Q2',
                title: 'Disciplinary Foundations & Theoretical Framework',
                description: 'Which scientific disciplines, fields, or methodological traditions inform this problem? What conceptual or theoretical frameworks will guide your research question?',
                placeholder: 'Describe the disciplines and frameworks informing your approach...'
            },
            {
                id: 'q3',
                number: 'Q3',
                title: 'Institutional & Mentorship Environment',
                description: 'Which departments, faculty mentors, and research environments at your institution align with your proposed K01 project? What unique resources, cores, datasets, or learning environments support your training plan?',
                placeholder: 'Describe your institutional environment and mentorship...'
            },
            {
                id: 'q4',
                number: 'Q4',
                title: 'Population & Phenotype Definition',
                description: 'Who or what is the target of study? Describe the population, group, system, workflow, or mechanism your project examines. Include: inclusion criteria, relevant demographics, contextual factors.',
                placeholder: 'Define your study population or target...'
            },
            {
                id: 'q5',
                number: 'Q5',
                title: 'Community, Clinical, and Nonprofit Partners',
                description: 'Which community organizations, advocacy groups, clinical partners, or nonprofits interact with the population or domain you plan to study? How might they support recruitment, feasibility, or dissemination?',
                placeholder: 'Describe relevant community and clinical partners...'
            },
            {
                id: 'q6',
                number: 'Q6',
                title: 'Clinical & Workforce Stakeholders',
                description: 'Which clinical departments, operational groups, accredited training environments, or health-system actors intersect with your research problem?',
                placeholder: 'Describe clinical and workforce stakeholders...'
            },
            {
                id: 'q7',
                number: 'Q7',
                title: 'Industry, Technology, and Innovation Landscape',
                description: 'Which for-profit organizations, companies, platforms, or technologies relate to your research topic? What tools, datasets, or innovations do they contribute?',
                placeholder: 'Describe relevant industry and technology landscape...'
            },
            {
                id: 'q8',
                number: 'Q8',
                title: 'Regulatory, Ethical, and Policy Considerations',
                description: 'What institutional policies, compliance considerations, accreditation rules, or regulatory frameworks govern your project? (e.g., IRB, HIPAA, ACGME, data-sharing rules)',
                placeholder: 'Describe regulatory and ethical considerations...'
            },
            {
                id: 'q9',
                number: 'Q9',
                title: 'Feasibility, Barriers, and Practical Constraints',
                description: 'What logistical, technical, financial, or operational constraints could affect your pilot data collection? What is feasible for a 1-year pilot phase?',
                placeholder: 'Describe barriers and constraints...'
            },
            {
                id: 'q10',
                number: 'Q10',
                title: 'Existing Methods, Measures, and Tools',
                description: 'What validated tools, datasets, measurement strategies, or analytic methods already exist for studying this problem? What gaps in measurement or methodology does your pilot aim to solve?',
                placeholder: 'Describe existing methods and gaps...'
            },
            {
                id: 'q11',
                number: 'Q11',
                title: 'Stakeholder Priorities, Scientific Alignment, & NIH Fit',
                description: 'Who are the scientific, clinical, administrative, or policy stakeholders in this space? How does your project align with your NIH institute\'s mission and career development priorities?',
                placeholder: 'Describe stakeholder priorities and NIH alignment...'
            },
            {
                id: 'q12',
                number: 'Q12',
                title: 'Funding Mechanisms & Next-Step Trajectory',
                description: 'What future funding pathways (K01, K08, K23, R03, R21, R01) does this project naturally lead into? What preliminary data would you need to secure a full K-award?',
                placeholder: 'Describe your funding trajectory...'
            },
            {
                id: 'q13',
                number: 'Q13',
                title: 'Technical Implementation',
                description: 'What systems, software, or infrastructure will your research require or produce? What data types will you handle? Who needs access to your systems or data?',
                placeholder: 'Describe technical implementation needs...'
            },
            {
                id: 'q14',
                number: 'Q14',
                title: 'Security & Privacy Considerations',
                description: 'What security or privacy concerns exist for your project? What compliance requirements apply? Would you benefit from a security architecture review?',
                placeholder: 'Describe security and privacy considerations...'
            }
        ];
        
        const weeklyCheckinQuestions = [
            {
                id: 'wc1',
                number: 'WC1',
                title: 'Progress This Week',
                description: 'What did you accomplish this week toward your research goals? What milestones did you reach?',
                placeholder: 'Describe your progress and accomplishments...'
            },
            {
                id: 'wc2',
                number: 'WC2',
                title: 'Barriers Encountered',
                description: 'What obstacles or challenges did you face this week? What slowed you down or blocked your progress?',
                placeholder: 'Describe any barriers or challenges...'
            },
            {
                id: 'wc3',
                number: 'WC3',
                title: 'Resources Needed',
                description: 'What resources, support, connections, or tools would help you move forward? What do you wish you had access to?',
                placeholder: 'Describe resources that would help...'
            },
            {
                id: 'wc4',
                number: 'WC4',
                title: 'What\'s Working Well',
                description: 'What aspects of your research environment, mentorship, or process are working well? What should we keep doing?',
                placeholder: 'Describe what\'s going well...'
            },
            {
                id: 'wc5',
                number: 'WC5',
                title: 'Next Week\'s Goals',
                description: 'What do you plan to accomplish next week? What are your immediate priorities?',
                placeholder: 'Describe your goals for next week...'
            }
        ];
        
        // State
        let currentSurveyType = 'full';
        let responses = JSON.parse(localStorage.getItem('reach_responses') || '[]');
        let currentFilter = 'all';
        
        // Initialize (only called after login via showApp())
        // document.addEventListener('DOMContentLoaded', ...) is handled in auth section
        
        // Navigation
        function setupNavigation() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const view = item.dataset.view;
                    if (!view) return;
                    
                    // Update active nav
                    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                    item.classList.add('active');
                    
                    // Show view
                    document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
                    document.getElementById(`view-${view}`).classList.remove('hidden');
                    
                    // Load view-specific data
                    if (view === 'dashboard') loadDashboard();
                    if (view === 'responses') loadAllResponses();
                });
            });
        }
        
        // Survey Type Toggle
        function setupSurveyToggle() {
            document.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentSurveyType = btn.dataset.survey;
                    renderQuestions();
                });
            });
        }
        
        // Render Questions
        function renderQuestions() {
            const container = document.getElementById('questions-container');
            const questions = currentSurveyType === 'full' ? fullSurveyQuestions : weeklyCheckinQuestions;
            
            container.innerHTML = questions.map(q => `
                <div class="question-card">
                    <span class="question-number">${q.number}</span>
                    <h3 class="question-title">${q.title}</h3>
                    <p class="question-description">${q.description}</p>
                    <textarea 
                        class="question-input" 
                        id="input-${q.id}" 
                        placeholder="${q.placeholder}"
                        oninput="updateProgress()"
                    ></textarea>
                </div>
            `).join('');
            
            updateProgress();
        }
        
        // Update Progress
        function updateProgress() {
            const questions = currentSurveyType === 'full' ? fullSurveyQuestions : weeklyCheckinQuestions;
            const answered = questions.filter(q => {
                const input = document.getElementById(`input-${q.id}`);
                return input && input.value.trim().length > 0;
            }).length;
            
            const total = questions.length;
            const percent = Math.round((answered / total) * 100);
            
            document.getElementById('progress-fill').style.width = `${percent}%`;
            document.getElementById('progress-text').textContent = `${answered} of ${total} questions`;
        }
        
        // Submit Survey
        function submitSurvey() {
            const name = document.getElementById('respondent-name').value.trim();
            const email = document.getElementById('respondent-email').value.trim();
            const role = document.getElementById('respondent-role').value;
            const institution = document.getElementById('respondent-institution').value.trim();
            const isManual = document.getElementById('manual-entry').checked;
            
            if (!name) {
                alert('Please enter the respondent\'s name.');
                return;
            }
            
            const questions = currentSurveyType === 'full' ? fullSurveyQuestions : weeklyCheckinQuestions;
            const answers = {};
            
            questions.forEach(q => {
                const input = document.getElementById(`input-${q.id}`);
                answers[q.id] = {
                    question: q.title,
                    answer: input ? input.value.trim() : ''
                };
            });
            
            const response = {
                id: Date.now().toString(),
                timestamp: new Date().toISOString(),
                type: currentSurveyType,
                isManual: isManual,
                respondent: {
                    name,
                    email,
                    role,
                    institution
                },
                answers
            };
            
            responses.unshift(response);
            localStorage.setItem('reach_responses', JSON.stringify(responses));
            updateResponseCount();
            
            // Show success
            document.getElementById('questions-container').classList.add('hidden');
            document.getElementById('survey-actions').classList.add('hidden');
            document.getElementById('success-message').classList.remove('hidden');
        }
        
        // Reset Survey
        function resetSurvey() {
            document.getElementById('respondent-name').value = '';
            document.getElementById('respondent-email').value = '';
            document.getElementById('respondent-role').value = '';
            document.getElementById('respondent-institution').value = '';
            document.getElementById('manual-entry').checked = false;
            
            document.getElementById('questions-container').classList.remove('hidden');
            document.getElementById('survey-actions').classList.remove('hidden');
            document.getElementById('success-message').classList.add('hidden');
            
            renderQuestions();
        }
        
        // Save Draft
        function saveDraft() {
            alert('Draft saving coming soon. For now, responses are saved on submit.');
        }
        
        // Update Response Count
        function updateResponseCount() {
            document.getElementById('response-count').textContent = responses.length;
        }
        
        // Load Dashboard
        function loadDashboard() {
            const total = responses.length;
            const surveys = responses.filter(r => r.type === 'full').length;
            const checkins = responses.filter(r => r.type === 'checkin').length;
            const manual = responses.filter(r => r.isManual).length;
            
            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-surveys').textContent = surveys;
            document.getElementById('stat-checkins').textContent = checkins;
            document.getElementById('stat-manual').textContent = manual;
            
            // Recent responses
            const container = document.getElementById('recent-responses');
            const recent = responses.slice(0, 5);
            
            if (recent.length === 0) {
                container.innerHTML = '<p style="color: var(--color-text-muted);">No responses yet.</p>';
                return;
            }
            
            container.innerHTML = recent.map(r => renderResponseCard(r)).join('');
        }
        
        // Load All Responses
        function loadAllResponses() {
            const container = document.getElementById('all-responses');
            let filtered = responses;
            
            if (currentFilter === 'full') {
                filtered = responses.filter(r => r.type === 'full' && !r.isManual);
            } else if (currentFilter === 'checkin') {
                filtered = responses.filter(r => r.type === 'checkin' && !r.isManual);
            } else if (currentFilter === 'manual') {
                filtered = responses.filter(r => r.isManual);
            }
            
            if (filtered.length === 0) {
                container.innerHTML = '<p style="color: var(--color-text-muted);">No responses found.</p>';
                return;
            }
            
            container.innerHTML = filtered.map(r => renderResponseCard(r)).join('');
        }
        
        // Render Response Card
        function renderResponseCard(response) {
            const date = new Date(response.timestamp).toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
            
            let typeClass = 'response-type--survey';
            let typeLabel = 'Full Survey';
            
            if (response.isManual) {
                typeClass = 'response-type--manual';
                typeLabel = 'Manual Entry';
            } else if (response.type === 'checkin') {
                typeClass = 'response-type--checkin';
                typeLabel = 'Check-in';
            }
            
            // Get first non-empty answer for preview
            const firstAnswer = Object.values(response.answers).find(a => a.answer.length > 0);
            const preview = firstAnswer ? firstAnswer.answer.substring(0, 150) + '...' : 'No answers provided';
            
            return `
                <div class="response-card" onclick="showResponseDetail('${response.id}')">
                    <div class="response-header">
                        <div>
                            <div class="response-name">${response.respondent.name}</div>
                            <div class="response-meta">${response.respondent.institution || 'No institution'}  ${date}</div>
                        </div>
                        <span class="response-type ${typeClass}">${typeLabel}</span>
                    </div>
                    <div class="response-preview">${preview}</div>
                    <div class="response-tags">
                        <span class="response-tag">${response.respondent.role || 'Unknown role'}</span>
                    </div>
                </div>
            `;
        }
        
        // Setup Filters
        function setupFilters() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    loadAllResponses();
                });
            });
        }
        
        // Show Response Detail
        function showResponseDetail(id) {
            const response = responses.find(r => r.id === id);
            if (!response) return;
            
            document.getElementById('modal-title').textContent = response.respondent.name;
            
            const body = document.getElementById('modal-body');
            body.innerHTML = `
                <div style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 1px solid var(--color-stone);">
                    <strong>Email:</strong> ${response.respondent.email || 'N/A'}<br>
                    <strong>Role:</strong> ${response.respondent.role || 'N/A'}<br>
                    <strong>Institution:</strong> ${response.respondent.institution || 'N/A'}<br>
                    <strong>Date:</strong> ${new Date(response.timestamp).toLocaleString()}<br>
                    <strong>Type:</strong> ${response.type === 'full' ? '12-14 Question Survey' : 'Weekly Check-in'}
                    ${response.isManual ? ' (Manual Entry)' : ''}
                </div>
                ${Object.entries(response.answers).map(([key, value]) => `
                    <div class="modal-response-item">
                        <div class="modal-question">${value.question}</div>
                        <div class="modal-answer">${value.answer || '<em>No answer provided</em>'}</div>
                    </div>
                `).join('')}
            `;
            
            document.getElementById('response-modal').classList.remove('hidden');
        }
        
        // Close Modal
        function closeModal() {
            document.getElementById('response-modal').classList.add('hidden');
        }
        
        // Export JSON
        function exportJSON() {
            const data = JSON.stringify(responses, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `reach-responses-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }
        
        // Import JSON
        function importJSON(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (Array.isArray(imported)) {
                        responses = [...imported, ...responses];
                        localStorage.setItem('reach_responses', JSON.stringify(responses));
                        updateResponseCount();
                        alert(`Imported ${imported.length} responses.`);
                    }
                } catch (err) {
                    alert('Error importing file. Please ensure it\'s a valid JSON file.');
                }
            };
            reader.readAsText(file);
        }
        
        // Export CSV
        function exportData() {
            // Simple CSV export
            const headers = ['Name', 'Email', 'Role', 'Institution', 'Date', 'Type', 'Manual'];
            const rows = responses.map(r => [
                r.respondent.name,
                r.respondent.email,
                r.respondent.role,
                r.respondent.institution,
                r.timestamp,
                r.type,
                r.isManual
            ]);
            
            const csv = [headers, ...rows].map(row => row.map(cell => `"${cell || ''}"`).join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `reach-responses-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }
        
        // Close modal on outside click
        document.getElementById('response-modal').addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                closeModal();
            }
        });
        
        // ============================================
        // ARTICLE CURATION SYSTEM
        // ============================================
        
        // Articles data (simulating shared JSON file)
        let articlesData = JSON.parse(localStorage.getItem('reach_articles') || '{"articles":[],"drafts":[],"suggestions":[]}');
        
        // Initialize with sample data if empty
        if (articlesData.articles.length === 0) {
            // Sample published articles
            articlesData.articles = [
                {
                    id: 1,
                    status: 'published',
                    category: 'prevent',
                    title: 'The Complete K-Award Application Timeline',
                    description: 'A month-by-month guide to preparing a competitive K-award application.',
                    readTime: '12 min read',
                    updated: 'November 2025',
                    sourcePatterns: ['mentor identification', 'K-award timeline'],
                    content: '<p>Sample content...</p>'
                }
            ];
            saveArticlesData();
        }
        
        function saveArticlesData() {
            localStorage.setItem('reach_articles', JSON.stringify(articlesData));
            updateSuggestionCount();
        }
        
        function updateSuggestionCount() {
            document.getElementById('suggestion-count').textContent = articlesData.suggestions.length;
        }
        
        // Pattern Analysis (simulated LLM)
        function analyzePatterns() {
            const output = document.getElementById('patterns-output');
            const loading = document.getElementById('patterns-loading');
            
            output.classList.add('hidden');
            loading.classList.remove('hidden');
            
            // Simulate LLM analysis delay
            setTimeout(() => {
                // Analyze responses for patterns
                const patterns = extractPatternsFromResponses();
                
                // Generate article suggestions
                const suggestions = generateArticleSuggestions(patterns);
                
                // Update UI
                loading.classList.add('hidden');
                output.classList.remove('hidden');
                
                // Update stats
                document.getElementById('pattern-barriers').textContent = patterns.barriers.length;
                document.getElementById('pattern-resources').textContent = patterns.resources.length;
                document.getElementById('pattern-themes').textContent = patterns.themes.length;
                
                // Show patterns
                output.innerHTML = `
                    <h3 style="margin-bottom: var(--space-md);">Pattern Analysis Results</h3>
                    
                    <div style="margin-bottom: var(--space-lg);">
                        <h4 style="font-size: 0.9rem; color: var(--color-teal); margin-bottom: var(--space-xs);">Common Barriers</h4>
                        <div>${patterns.barriers.map(b => `<span class="pattern-tag">${b}</span>`).join('') || '<span style="color: var(--color-text-muted);">No barriers identified yet</span>'}</div>
                    </div>
                    
                    <div style="margin-bottom: var(--space-lg);">
                        <h4 style="font-size: 0.9rem; color: var(--color-terracotta); margin-bottom: var(--space-xs);">Resources Needed</h4>
                        <div>${patterns.resources.map(r => `<span class="pattern-tag" style="background: var(--color-terracotta-light); color: var(--color-terracotta);">${r}</span>`).join('') || '<span style="color: var(--color-text-muted);">No resource needs identified yet</span>'}</div>
                    </div>
                    
                    <div style="margin-bottom: var(--space-lg);">
                        <h4 style="font-size: 0.9rem; color: #D97706; margin-bottom: var(--space-xs);">Emerging Themes</h4>
                        <div>${patterns.themes.map(t => `<span class="pattern-tag" style="background: #FEF3E7; color: #D97706;">${t}</span>`).join('') || '<span style="color: var(--color-text-muted);">No themes identified yet</span>'}</div>
                    </div>
                    
                    ${suggestions.length > 0 ? `
                        <div style="background: var(--color-teal-light); padding: var(--space-md); border-radius: 8px; margin-top: var(--space-lg);">
                            <strong style="color: var(--color-teal-dark);"> ${suggestions.length} article suggestion(s) generated!</strong>
                            <p style="font-size: 0.9rem; color: var(--color-teal-dark); margin: var(--space-xs) 0 0 0;">
                                Go to Article Curation  Suggestions to review and publish.
                            </p>
                        </div>
                    ` : ''}
                `;
                
                // Add suggestions to data
                if (suggestions.length > 0) {
                    articlesData.suggestions = [...suggestions, ...articlesData.suggestions];
                    saveArticlesData();
                }
                
            }, 2000);
        }
        
        function extractPatternsFromResponses() {
            // Analyze all responses to find patterns
            const barriers = [];
            const resources = [];
            const themes = [];
            
            // Keywords to look for
            const barrierKeywords = ['difficult', 'struggle', 'barrier', 'challenge', 'problem', 'issue', 'hard', 'blocked', 'delay'];
            const resourceKeywords = ['need', 'want', 'wish', 'help', 'support', 'access', 'resource', 'funding'];
            
            responses.forEach(r => {
                Object.values(r.answers).forEach(a => {
                    const text = a.answer.toLowerCase();
                    
                    // Check for barriers
                    if (barrierKeywords.some(k => text.includes(k))) {
                        if (text.includes('irb')) barriers.push('IRB process');
                        if (text.includes('mentor')) barriers.push('Mentor access');
                        if (text.includes('time')) barriers.push('Time constraints');
                        if (text.includes('fund') || text.includes('money')) barriers.push('Funding gaps');
                        if (text.includes('data')) barriers.push('Data access');
                    }
                    
                    // Check for resources
                    if (resourceKeywords.some(k => text.includes(k))) {
                        if (text.includes('statistic')) resources.push('Statistical support');
                        if (text.includes('writing')) resources.push('Writing assistance');
                        if (text.includes('mentor')) resources.push('Mentorship');
                        if (text.includes('pilot')) resources.push('Pilot funding');
                    }
                    
                    // Extract themes
                    if (text.includes('k-award') || text.includes('k01') || text.includes('k23')) themes.push('K-award preparation');
                    if (text.includes('reloc') || text.includes('mov')) themes.push('Relocation');
                    if (text.includes('burnout') || text.includes('stress')) themes.push('Wellbeing');
                    if (text.includes('career')) themes.push('Career planning');
                });
            });
            
            // Deduplicate
            return {
                barriers: [...new Set(barriers)],
                resources: [...new Set(resources)],
                themes: [...new Set(themes)]
            };
        }
        
        function generateArticleSuggestions(patterns) {
            const suggestions = [];
            const timestamp = Date.now();
            
            // Generate suggestions based on patterns
            if (patterns.barriers.includes('IRB process')) {
                suggestions.push({
                    id: timestamp + 1,
                    category: 'remove',
                    title: 'Speeding Up Your IRB Submission: Common Mistakes to Avoid',
                    description: 'Based on trainee feedback, here are the most common reasons for IRB delays and how to prevent them.',
                    sourcePatterns: ['IRB process', 'regulatory delays'],
                    content: generateArticleContent('irb'),
                    readTime: '8 min read',
                    updated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' })
                });
            }
            
            if (patterns.barriers.includes('Mentor access') || patterns.resources.includes('Mentorship')) {
                suggestions.push({
                    id: timestamp + 2,
                    category: 'remove',
                    title: 'Finding a Research Mentor: Strategies That Actually Work',
                    description: 'Practical approaches for trainees who don\'t have built-in connections to potential mentors.',
                    sourcePatterns: ['mentor search', 'networking', 'first-generation'],
                    content: generateArticleContent('mentor'),
                    readTime: '10 min read',
                    updated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' })
                });
            }
            
            if (patterns.themes.includes('Wellbeing') || patterns.barriers.includes('Time constraints')) {
                suggestions.push({
                    id: timestamp + 3,
                    category: 'identify',
                    title: 'Recognizing Early Signs of Research Burnout',
                    description: 'Warning signs that your research-clinical balance is unsustainable, and what to do about it.',
                    sourcePatterns: ['burnout', 'stress', 'work-life balance'],
                    content: generateArticleContent('burnout'),
                    readTime: '6 min read',
                    updated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' })
                });
            }
            
            if (patterns.barriers.includes('Funding gaps') || patterns.resources.includes('Pilot funding')) {
                suggestions.push({
                    id: timestamp + 4,
                    category: 'prevent',
                    title: 'Finding Pilot Funding Before Your K-Award: A Comprehensive Guide',
                    description: 'Institutional, foundation, and creative funding sources to generate preliminary data.',
                    sourcePatterns: ['pilot funding', 'preliminary data', 'grants'],
                    content: generateArticleContent('funding'),
                    readTime: '11 min read',
                    updated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' })
                });
            }
            
            return suggestions;
        }
        
        function generateArticleContent(type) {
            // Simulated LLM-generated content templates
            const templates = {
                irb: `<p>Multiple trainees have reported IRB delays as a significant barrier to their research progress. This guide synthesizes their experiences into actionable advice.</p>
                
<h2>The Most Common Delay: Consent Form Language</h2>
<p>IRBs frequently return protocols because consent forms are written at too high a reading level. Aim for 8th grade or below.</p>

<h2>Missing HIPAA Documentation</h2>
<p>If you're accessing any protected health information, you need HIPAA authorization formseven for chart reviews.</p>

<div class="callout">
<div class="callout-title"> Pro Tip</div>
<p>Before submitting, ask a colleague who's never seen your protocol to read your consent form. If they have questions, your participants will too.</p>
</div>`,

                mentor: `<p>Finding a research mentor without existing connections is one of the most common challenges reported by trainees, especially those who are first-generation physicians.</p>

<h2>Start with NIH RePORTER</h2>
<p>This free database shows you who has funding in your area of interestand whether they've mentored K-awardees before.</p>

<h2>The Cold Email That Works</h2>
<p>Keep it under 200 words. Be specific about why you're reaching out to them specifically. Ask for a 20-minute conversation, not a lifetime commitment.</p>

<div class="callout">
<div class="callout-title"> Key Insight</div>
<p>Lack of response isn't always rejectionbusy faculty miss emails. One follow-up after 7-10 days is appropriate.</p>
</div>`,

                burnout: `<p>Several trainees have mentioned feeling overwhelmed balancing research and clinical responsibilities. Here's how to recognize when you're heading toward burnout.</p>

<h2>Early Warning Signs</h2>
<ul>
<li>Dreading work even after adequate rest</li>
<li>Counting down days until vacation</li>
<li>Irritability with colleagues or loved ones</li>
<li>Difficulty concentrating on tasks you used to find engaging</li>
</ul>

<h2>What To Do</h2>
<p>Talk to someoneyour program director, a mentor, or EAP. You're not the first person to feel this way.</p>

<div class="callout">
<div class="callout-title"> Resources</div>
<p>Physician Support Line (free, confidential): 1-888-409-0141</p>
</div>`,

                funding: `<p>The preliminary data paradox is real: you need data to get K-award funding, but you need funding to get data. Here's how trainees have solved this.</p>

<h2>Institutional Sources</h2>
<ul>
<li>Department pilot grants (ask your research office)</li>
<li>Dean's office discretionary funds</li>
<li>Center-specific awards (check all affiliated centers)</li>
</ul>

<h2>Foundation Sources</h2>
<p>Many specialty societies offer small grants ($5-25K) specifically for trainees. Check your professional society's website.</p>

<div class="callout">
<div class="callout-title"> Hidden Opportunity</div>
<p>Some mentors have discretionary funds from their grants that can support trainee projects. It never hurts to ask.</p>
</div>`
            };
            
            return templates[type] || '<p>Article content to be written...</p>';
        }
        
        // Curation Tab Navigation
        function showTab(tabName) {
            document.querySelectorAll('.curation-tab').forEach(t => t.classList.add('hidden'));
            document.getElementById(`tab-${tabName}`).classList.remove('hidden');
            
            // Load content
            if (tabName === 'suggestions') loadSuggestions();
            if (tabName === 'drafts') loadDrafts();
            if (tabName === 'published') loadPublished();
        }
        
        function loadSuggestions() {
            const container = document.getElementById('suggestions-list');
            
            if (articlesData.suggestions.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: var(--space-xl); color: var(--color-text-muted);">
                        <div style="font-size: 2rem; margin-bottom: var(--space-sm);"></div>
                        <p>No article suggestions yet.</p>
                        <p style="font-size: 0.9rem;">Go to Patterns and click "Analyze Responses" to generate suggestions based on survey data.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = articlesData.suggestions.map(s => `
                <div class="article-item">
                    <div class="article-item-header">
                        <div>
                            <span class="article-category-badge article-category-badge--${s.category}">
                                ${s.category === 'prevent' ? ' Prevent' : s.category === 'identify' ? ' Identify' : ' Remove'}
                            </span>
                            <div class="article-item-title">${s.title}</div>
                            <div class="article-item-meta">${s.readTime}  Generated ${s.updated}</div>
                        </div>
                    </div>
                    <div class="article-item-description">${s.description}</div>
                    <div class="suggestion-source">
                        <div class="suggestion-source-title">Based on patterns:</div>
                        ${s.sourcePatterns.map(p => `<span class="pattern-tag">${p}</span>`).join('')}
                    </div>
                    <div class="article-item-actions" style="margin-top: var(--space-sm);">
                        <button class="btn btn--secondary" onclick="editSuggestion(${s.id})">Edit & Review</button>
                        <button class="btn btn--primary" onclick="quickPublish(${s.id})">Quick Publish</button>
                        <button class="btn btn--secondary" onclick="dismissSuggestion(${s.id})" style="color: var(--color-text-muted);">Dismiss</button>
                    </div>
                </div>
            `).join('');
        }
        
        function loadDrafts() {
            const container = document.getElementById('drafts-list');
            
            if (articlesData.drafts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: var(--space-xl); color: var(--color-text-muted);">
                        <div style="font-size: 2rem; margin-bottom: var(--space-sm);"></div>
                        <p>No drafts yet.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = articlesData.drafts.map(d => `
                <div class="article-item">
                    <div class="article-item-header">
                        <div>
                            <span class="article-category-badge article-category-badge--${d.category}">
                                ${d.category === 'prevent' ? ' Prevent' : d.category === 'identify' ? ' Identify' : ' Remove'}
                            </span>
                            <div class="article-item-title">${d.title}</div>
                            <div class="article-item-meta">${d.readTime}  Draft</div>
                        </div>
                    </div>
                    <div class="article-item-description">${d.description}</div>
                    <div class="article-item-actions" style="margin-top: var(--space-sm);">
                        <button class="btn btn--secondary" onclick="editDraft(${d.id})">Edit</button>
                        <button class="btn btn--primary" onclick="publishDraft(${d.id})">Publish</button>
                        <button class="btn btn--secondary" onclick="deleteDraft(${d.id})" style="color: var(--color-text-muted);">Delete</button>
                    </div>
                </div>
            `).join('');
        }
        
        function loadPublished() {
            const container = document.getElementById('published-list');
            
            if (articlesData.articles.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: var(--space-xl); color: var(--color-text-muted);">
                        <div style="font-size: 2rem; margin-bottom: var(--space-sm);"></div>
                        <p>No published articles yet.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = articlesData.articles.map(a => `
                <div class="article-item">
                    <div class="article-item-header">
                        <div>
                            <span class="article-category-badge article-category-badge--${a.category}">
                                ${a.category === 'prevent' ? ' Prevent' : a.category === 'identify' ? ' Identify' : ' Remove'}
                            </span>
                            <div class="article-item-title">${a.title}</div>
                            <div class="article-item-meta">${a.readTime}  Published ${a.updated}</div>
                        </div>
                        <span style="background: #ECFDF5; color: #059669; font-size: 0.75rem; padding: 0.2rem 0.6rem; border-radius: 4px;">Live</span>
                    </div>
                    <div class="article-item-description">${a.description}</div>
                    <div class="article-item-actions" style="margin-top: var(--space-sm);">
                        <button class="btn btn--secondary" onclick="editPublished(${a.id})">Edit</button>
                        <button class="btn btn--secondary" onclick="unpublish(${a.id})" style="color: var(--color-text-muted);">Unpublish</button>
                    </div>
                </div>
            `).join('');
        }
        
        // Editor functions
        let currentEditId = null;
        let currentEditSource = null; // 'suggestion', 'draft', 'published', 'new'
        
        function editSuggestion(id) {
            const suggestion = articlesData.suggestions.find(s => s.id === id);
            if (!suggestion) return;
            
            currentEditId = id;
            currentEditSource = 'suggestion';
            openEditor(suggestion);
        }
        
        function editDraft(id) {
            const draft = articlesData.drafts.find(d => d.id === id);
            if (!draft) return;
            
            currentEditId = id;
            currentEditSource = 'draft';
            openEditor(draft);
        }
        
        function editPublished(id) {
            const article = articlesData.articles.find(a => a.id === id);
            if (!article) return;
            
            currentEditId = id;
            currentEditSource = 'published';
            openEditor(article);
        }
        
        function createNewArticle() {
            currentEditId = Date.now();
            currentEditSource = 'new';
            openEditor({
                category: 'prevent',
                title: '',
                description: '',
                content: '<p>Write your article content here...</p>',
                sourcePatterns: []
            });
        }
        
        function openEditor(data) {
            document.getElementById('editor-category').value = data.category;
            document.getElementById('editor-article-title').value = data.title;
            document.getElementById('editor-description').value = data.description;
            document.getElementById('editor-content').value = data.content;
            document.getElementById('editor-patterns').value = (data.sourcePatterns || []).join(', ');
            
            document.getElementById('editor-modal').classList.remove('hidden');
        }
        
        function closeEditor() {
            document.getElementById('editor-modal').classList.add('hidden');
            currentEditId = null;
            currentEditSource = null;
        }
        
        function getEditorData() {
            return {
                id: currentEditId,
                category: document.getElementById('editor-category').value,
                title: document.getElementById('editor-article-title').value,
                description: document.getElementById('editor-description').value,
                content: document.getElementById('editor-content').value,
                sourcePatterns: document.getElementById('editor-patterns').value.split(',').map(p => p.trim()).filter(p => p),
                readTime: estimateReadTime(document.getElementById('editor-content').value),
                updated: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' })
            };
        }
        
        function estimateReadTime(content) {
            const words = content.replace(/<[^>]*>/g, '').split(/\s+/).length;
            const minutes = Math.ceil(words / 200);
            return `${minutes} min read`;
        }
        
        function saveAsDraft() {
            const data = getEditorData();
            
            // Remove from suggestions if it came from there
            if (currentEditSource === 'suggestion') {
                articlesData.suggestions = articlesData.suggestions.filter(s => s.id !== currentEditId);
            }
            
            // Add/update in drafts
            const existingIndex = articlesData.drafts.findIndex(d => d.id === data.id);
            if (existingIndex >= 0) {
                articlesData.drafts[existingIndex] = data;
            } else {
                articlesData.drafts.unshift(data);
            }
            
            saveArticlesData();
            closeEditor();
            showTab('drafts');
        }
        
        function publishArticle() {
            const data = getEditorData();
            data.status = 'published';
            
            // Remove from source
            if (currentEditSource === 'suggestion') {
                articlesData.suggestions = articlesData.suggestions.filter(s => s.id !== currentEditId);
            } else if (currentEditSource === 'draft') {
                articlesData.drafts = articlesData.drafts.filter(d => d.id !== currentEditId);
            }
            
            // Add/update in published
            const existingIndex = articlesData.articles.findIndex(a => a.id === data.id);
            if (existingIndex >= 0) {
                articlesData.articles[existingIndex] = data;
            } else {
                articlesData.articles.unshift(data);
            }
            
            saveArticlesData();
            closeEditor();
            showTab('published');
            
            alert('Article published to REACH Access!');
        }
        
        function quickPublish(id) {
            const suggestion = articlesData.suggestions.find(s => s.id === id);
            if (!suggestion) return;
            
            suggestion.status = 'published';
            articlesData.articles.unshift(suggestion);
            articlesData.suggestions = articlesData.suggestions.filter(s => s.id !== id);
            
            saveArticlesData();
            loadSuggestions();
            
            alert('Article published to REACH Access!');
        }
        
        function dismissSuggestion(id) {
            articlesData.suggestions = articlesData.suggestions.filter(s => s.id !== id);
            saveArticlesData();
            loadSuggestions();
        }
        
        function publishDraft(id) {
            const draft = articlesData.drafts.find(d => d.id === id);
            if (!draft) return;
            
            draft.status = 'published';
            articlesData.articles.unshift(draft);
            articlesData.drafts = articlesData.drafts.filter(d => d.id !== id);
            
            saveArticlesData();
            loadDrafts();
            
            alert('Article published to REACH Access!');
        }
        
        function deleteDraft(id) {
            if (!confirm('Delete this draft?')) return;
            articlesData.drafts = articlesData.drafts.filter(d => d.id !== id);
            saveArticlesData();
            loadDrafts();
        }
        
        function unpublish(id) {
            if (!confirm('Unpublish this article? It will be moved to drafts.')) return;
            
            const article = articlesData.articles.find(a => a.id === id);
            if (!article) return;
            
            article.status = 'draft';
            articlesData.drafts.unshift(article);
            articlesData.articles = articlesData.articles.filter(a => a.id !== id);
            
            saveArticlesData();
            loadPublished();
        }
        
        // Load curation data when navigating
        function loadCurationView() {
            showTab('suggestions');
        }
        
        // Update navigation to load curation
        const originalNavSetup = setupNavigation;
        setupNavigation = function() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const view = item.dataset.view;
                    if (!view) return;
                    
                    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                    item.classList.add('active');
                    
                    document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
                    document.getElementById(`view-${view}`).classList.remove('hidden');
                    
                    if (view === 'dashboard') loadDashboard();
                    if (view === 'responses') loadAllResponses();
                    if (view === 'curation') loadCurationView();
                    if (view === 'topics') loadTopicsView();
                    if (view === 'relocations') loadRelocationsView();
                    if (view === 'sponsors') loadSponsorsView();
                    if (view === 'sponsor-needs') loadSponsorNeedsView();
                    if (view === 'matching') loadMatchingView();
                });
            });
        };
        
        // Initialize suggestion count
        updateSuggestionCount();
        
        // ============================================
        // TOPIC REQUESTS (from REACH Access)
        // ============================================
        
        let topicFilter = 'all';
        
        function getTopicRequests() {
            return JSON.parse(localStorage.getItem('reach_topic_suggestions') || '[]');
        }
        
        function saveTopicRequests(topics) {
            localStorage.setItem('reach_topic_suggestions', JSON.stringify(topics));
            updateTopicCount();
        }
        
        function updateTopicCount() {
            const topics = getTopicRequests();
            const newCount = topics.filter(t => t.status === 'new').length;
            document.getElementById('topic-count').textContent = newCount;
        }
        
        function loadTopicsView() {
            const topics = getTopicRequests();
            const container = document.getElementById('topics-list');
            const statsEl = document.getElementById('topic-stats');
            
            // Filter topics
            let filtered = topics;
            if (topicFilter !== 'all') {
                filtered = topics.filter(t => t.status === topicFilter);
            }
            
            // Update stats
            const newCount = topics.filter(t => t.status === 'new').length;
            const reviewedCount = topics.filter(t => t.status === 'reviewed').length;
            const convertedCount = topics.filter(t => t.status === 'converted').length;
            statsEl.textContent = `${topics.length} total  ${newCount} new  ${reviewedCount} reviewed  ${convertedCount} converted`;
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: var(--space-xl); color: var(--color-text-muted);">
                        <div style="font-size: 2rem; margin-bottom: var(--space-sm);"></div>
                        <p>${topicFilter === 'all' ? 'No topic requests yet.' : `No ${topicFilter} topics.`}</p>
                        <p style="font-size: 0.9rem;">Topics submitted on REACH Access will appear here.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filtered.map(topic => {
                const date = new Date(topic.submittedAt).toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit'
                });
                
                return `
                    <div class="topic-item topic-item--${topic.status}">
                        <div class="topic-content">
                            <div class="topic-text">${escapeHtml(topic.topic)}</div>
                            <div class="topic-meta">Submitted: ${date}</div>
                        </div>
                        <div class="topic-actions">
                            <span class="topic-status topic-status--${topic.status}">${topic.status}</span>
                            ${topic.status === 'new' ? `
                                <button class="btn btn--secondary" onclick="markTopicReviewed(${topic.id})">Mark Reviewed</button>
                                <button class="btn btn--primary" onclick="convertTopicToArticle(${topic.id})">Create Article</button>
                            ` : ''}
                            ${topic.status === 'reviewed' ? `
                                <button class="btn btn--primary" onclick="convertTopicToArticle(${topic.id})">Create Article</button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function filterTopics(filter) {
            topicFilter = filter;
            
            // Update filter buttons
            document.querySelectorAll('[data-topic-filter]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.topicFilter === filter);
            });
            
            loadTopicsView();
        }
        
        function markTopicReviewed(id) {
            const topics = getTopicRequests();
            const topic = topics.find(t => t.id === id);
            if (topic) {
                topic.status = 'reviewed';
                saveTopicRequests(topics);
                loadTopicsView();
            }
        }
        
        function convertTopicToArticle(id) {
            const topics = getTopicRequests();
            const topic = topics.find(t => t.id === id);
            if (!topic) return;
            
            // Mark as converted
            topic.status = 'converted';
            saveTopicRequests(topics);
            
            // Create a new article suggestion based on this topic
            currentEditId = Date.now();
            currentEditSource = 'new';
            openEditor({
                category: 'remove', // Default to "Removing Barriers"
                title: '',
                description: '',
                content: `<p>This article addresses the question: "${escapeHtml(topic.topic)}"</p>\n\n<h2>Overview</h2>\n<p>Write your content here...</p>`,
                sourcePatterns: ['user request']
            });
            
            // Switch to curation view
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.querySelector('[data-view="curation"]').classList.add('active');
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
            document.getElementById('view-curation').classList.remove('hidden');
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Update topic count on init
        updateTopicCount();
        
        // ============================================
        // SPONSOR MANAGEMENT
        // ============================================
        
        function getSponsors() {
            return JSON.parse(localStorage.getItem('reach_sponsors') || '[]');
        }
        
        function saveSponsors(sponsors) {
            localStorage.setItem('reach_sponsors', JSON.stringify(sponsors));
            updateSponsorCount();
        }
        
        function updateSponsorCount() {
            const sponsors = getSponsors();
            const activeCount = sponsors.filter(s => s.status === 'active').length;
            document.getElementById('sponsor-count').textContent = sponsors.length;
        }
        
        function saveSponsor(event) {
            event.preventDefault();
            
            const categories = Array.from(document.querySelectorAll('input[name="sponsor-category"]:checked')).map(c => c.value);
            const audiences = Array.from(document.querySelectorAll('input[name="sponsor-audience"]:checked')).map(a => a.value);
            const events = Array.from(document.querySelectorAll('input[name="sponsor-events"]:checked')).map(e => e.value);
            const channels = Array.from(document.querySelectorAll('input[name="sponsor-channels"]:checked')).map(c => c.value);
            
            const sponsor = {
                id: Date.now(),
                company: document.getElementById('sponsor-company').value,
                contact: document.getElementById('sponsor-contact').value,
                email: document.getElementById('sponsor-email').value,
                phone: document.getElementById('sponsor-phone').value || '',
                website: document.getElementById('sponsor-website').value || '',
                categories: categories,
                services: document.getElementById('sponsor-services').value || '',
                geography: document.getElementById('sponsor-geography').value || '',
                offers: document.getElementById('sponsor-offers').value || '',
                audiences: audiences,
                events: events,
                contentStyle: document.getElementById('sponsor-content-style').value || '',
                channels: channels,
                status: document.getElementById('sponsor-status').value,
                contribution: document.getElementById('sponsor-contribution').value || 0,
                notes: document.getElementById('sponsor-notes').value || '',
                createdAt: new Date().toISOString()
            };
            
            const sponsors = getSponsors();
            sponsors.unshift(sponsor);
            saveSponsors(sponsors);
            
            alert('Sponsor saved successfully!');
            clearSponsorForm();
            
            // Navigate to sponsors list
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.querySelector('[data-view="sponsors"]').classList.add('active');
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
            document.getElementById('view-sponsors').classList.remove('hidden');
            loadSponsorsView();
        }
        
        function clearSponsorForm() {
            document.getElementById('sponsor-form').reset();
        }
        
        let sponsorFilter = 'all';
        
        function loadSponsorsView() {
            const sponsors = getSponsors();
            const container = document.getElementById('sponsors-list');
            const statsEl = document.getElementById('sponsor-stats');
            
            // Filter
            let filtered = sponsors;
            if (sponsorFilter !== 'all') {
                filtered = sponsors.filter(s => s.status === sponsorFilter);
            }
            
            // Stats
            const activeCount = sponsors.filter(s => s.status === 'active').length;
            const pendingCount = sponsors.filter(s => s.status === 'pending').length;
            const prospectCount = sponsors.filter(s => s.status === 'prospect').length;
            const totalContributions = sponsors.filter(s => s.status === 'active').reduce((sum, s) => sum + (parseInt(s.contribution) || 0), 0);
            
            statsEl.textContent = `${sponsors.length} total  ${activeCount} active  $${totalContributions}/mo contributions`;
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: var(--space-xl); color: var(--color-text-muted);">
                        <div style="font-size: 2rem; margin-bottom: var(--space-sm);"></div>
                        <p>${sponsorFilter === 'all' ? 'No sponsors yet.' : `No ${sponsorFilter} sponsors.`}</p>
                        <button class="btn btn--primary" onclick="navigateTo('new-sponsor')" style="margin-top: var(--space-md);">Add First Sponsor</button>
                    </div>
                `;
                return;
            }
            
            const categoryLabels = {
                'real-estate': ' Real Estate',
                'mortgage': ' Mortgage',
                'financial': ' Financial',
                'insurance': ' Insurance',
                'legal': ' Legal',
                'moving': ' Moving',
                'tax': ' Tax',
                'career': ' Career',
                'wellness': ' Wellness',
                'other': ' Other'
            };
            
            container.innerHTML = filtered.map(sponsor => `
                <div class="sponsor-card sponsor-card--${sponsor.status}">
                    <div class="sponsor-header">
                        <div class="sponsor-name">${escapeHtml(sponsor.company)}</div>
                        <span class="sponsor-status sponsor-status--${sponsor.status}">${sponsor.status}</span>
                    </div>
                    <div class="sponsor-contact">${escapeHtml(sponsor.contact)}  ${escapeHtml(sponsor.email)}</div>
                    <div class="sponsor-categories">
                        ${sponsor.categories.map(c => `<span class="sponsor-category-tag">${categoryLabels[c] || c}</span>`).join('')}
                    </div>
                    ${sponsor.services ? `<p style="font-size: 0.85rem; color: var(--color-text-secondary); margin-bottom: var(--space-sm);">${escapeHtml(sponsor.services).substring(0, 100)}${sponsor.services.length > 100 ? '...' : ''}</p>` : ''}
                    <div class="sponsor-meta">
                        <span>${sponsor.geography || 'No geography set'}</span>
                        <span>${sponsor.contribution ? `$${sponsor.contribution}/mo` : 'No contribution'}</span>
                    </div>
                    <div class="sponsor-actions">
                        <button class="btn btn--secondary" onclick="viewSponsor(${sponsor.id})">View</button>
                        <button class="btn btn--secondary" onclick="editSponsor(${sponsor.id})">Edit</button>
                        ${sponsor.status === 'prospect' ? `<button class="btn btn--primary" onclick="updateSponsorStatus(${sponsor.id}, 'pending')">Start Discussion</button>` : ''}
                        ${sponsor.status === 'pending' ? `<button class="btn btn--primary" onclick="updateSponsorStatus(${sponsor.id}, 'active')">Activate</button>` : ''}
                    </div>
                </div>
            `).join('');
        }
        
        function filterSponsors(filter) {
            sponsorFilter = filter;
            
            document.querySelectorAll('[data-sponsor-filter]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.sponsorFilter === filter);
            });
            
            loadSponsorsView();
        }
        
        function updateSponsorStatus(id, newStatus) {
            const sponsors = getSponsors();
            const sponsor = sponsors.find(s => s.id === id);
            if (sponsor) {
                sponsor.status = newStatus;
                saveSponsors(sponsors);
                loadSponsorsView();
            }
        }
        
        function viewSponsor(id) {
            const sponsors = getSponsors();
            const sponsor = sponsors.find(s => s.id === id);
            if (!sponsor) return;
            
            const categoryLabels = {
                'real-estate': ' Real Estate',
                'mortgage': ' Mortgage',
                'financial': ' Financial',
                'insurance': ' Insurance',
                'legal': ' Legal',
                'moving': ' Moving',
                'tax': ' Tax',
                'career': ' Career',
                'wellness': ' Wellness',
                'other': ' Other'
            };
            
            const stageLabels = {
                'medical-student': 'Medical Students',
                'resident': 'Residents',
                'fellow': 'Fellows',
                'early-faculty': 'Early Faculty'
            };
            
            const eventLabels = {
                'relocating': 'Relocating',
                'buying-home': 'Buying a Home',
                'starting-training': 'Starting Training',
                'finishing-training': 'Finishing Training',
                'job-searching': 'Job Searching',
                'loan-repayment': 'Loan Repayment',
                'contract-review': 'Contract Review',
                'burnout': 'Burnout/Stress'
            };
            
            document.getElementById('modal-title').textContent = sponsor.company;
            document.getElementById('modal-body').innerHTML = `
                <div class="sponsor-detail">
                    <div class="detail-section">
                        <h4>Contact Information</h4>
                        <p><strong>Contact:</strong> ${escapeHtml(sponsor.contact)}</p>
                        <p><strong>Email:</strong> ${escapeHtml(sponsor.email)}</p>
                        ${sponsor.phone ? `<p><strong>Phone:</strong> ${escapeHtml(sponsor.phone)}</p>` : ''}
                        ${sponsor.website ? `<p><strong>Website:</strong> <a href="${escapeHtml(sponsor.website)}" target="_blank">${escapeHtml(sponsor.website)}</a></p>` : ''}
                    </div>
                    
                    <div class="detail-section">
                        <h4>Services</h4>
                        <p><strong>Categories:</strong> ${sponsor.categories.map(c => categoryLabels[c] || c).join(', ')}</p>
                        ${sponsor.services ? `<p><strong>Description:</strong> ${escapeHtml(sponsor.services)}</p>` : ''}
                        ${sponsor.geography ? `<p><strong>Geography:</strong> ${escapeHtml(sponsor.geography)}</p>` : ''}
                        ${sponsor.offers ? `<p><strong>Special Offers:</strong> ${escapeHtml(sponsor.offers)}</p>` : ''}
                    </div>
                    
                    <div class="detail-section">
                        <h4>Target Audience</h4>
                        <p><strong>Career Stages:</strong> ${sponsor.audiences.map(a => stageLabels[a] || a).join(', ') || 'Not specified'}</p>
                        <p><strong>Life Events:</strong> ${sponsor.events.map(e => eventLabels[e] || e).join(', ') || 'Not specified'}</p>
                    </div>
                    
                    <div class="detail-section">
                        <h4>Sponsorship</h4>
                        <p><strong>Status:</strong> <span class="sponsor-status sponsor-status--${sponsor.status}">${sponsor.status}</span></p>
                        <p><strong>Monthly Contribution:</strong> ${sponsor.contribution ? `$${sponsor.contribution}` : 'Not set'}</p>
                        ${sponsor.notes ? `<p><strong>Notes:</strong> ${escapeHtml(sponsor.notes)}</p>` : ''}
                    </div>
                </div>
            `;
            document.getElementById('response-modal').classList.remove('hidden');
        }
        
        function editSponsor(id) {
            alert('Edit functionality coming soon. For now, view the sponsor details.');
        }
        
        function navigateTo(view) {
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.querySelector(`[data-view="${view}"]`).classList.add('active');
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
            document.getElementById(`view-${view}`).classList.remove('hidden');
        }
        
        // ============================================
        // NEEDS MATCHING
        // ============================================
        
        function loadMatchingView() {
            loadTraineeNeeds();
            loadSponsorServices();
            generateMatchSuggestions();
        }
        
        function loadTraineeNeeds() {
            const responses = JSON.parse(localStorage.getItem('reach_responses') || '[]');
            const container = document.getElementById('trainee-needs-list');
            
            // Extract needs from survey responses
            const needs = [];
            
            responses.forEach(r => {
                // Check for relocation mentions
                if (r.answers) {
                    Object.values(r.answers).forEach(answer => {
                        if (typeof answer === 'string') {
                            const lowerAnswer = answer.toLowerCase();
                            
                            if (lowerAnswer.includes('relocat') || lowerAnswer.includes('moving') || lowerAnswer.includes('move to')) {
                                needs.push({ type: 'relocation', text: 'Needs relocation assistance', source: r.name, respondentId: r.id });
                            }
                            if (lowerAnswer.includes('mentor') && (lowerAnswer.includes('need') || lowerAnswer.includes('find') || lowerAnswer.includes('looking'))) {
                                needs.push({ type: 'mentorship', text: 'Looking for mentor', source: r.name, respondentId: r.id });
                            }
                            if (lowerAnswer.includes('funding') || lowerAnswer.includes('pilot grant') || lowerAnswer.includes('financial')) {
                                needs.push({ type: 'funding', text: 'Needs funding support', source: r.name, respondentId: r.id });
                            }
                            if (lowerAnswer.includes('burnout') || lowerAnswer.includes('stress') || lowerAnswer.includes('overwhelm')) {
                                needs.push({ type: 'wellness', text: 'Experiencing burnout/stress', source: r.name, respondentId: r.id });
                            }
                            if (lowerAnswer.includes('contract') || lowerAnswer.includes('legal')) {
                                needs.push({ type: 'legal', text: 'Needs contract/legal help', source: r.name, respondentId: r.id });
                            }
                            if (lowerAnswer.includes('loan') || lowerAnswer.includes('debt') || lowerAnswer.includes('repayment')) {
                                needs.push({ type: 'financial', text: 'Needs financial planning', source: r.name, respondentId: r.id });
                            }
                        }
                    });
                }
            });
            
            if (needs.length === 0) {
                container.innerHTML = `<div style="text-align: center; padding: var(--space-md); color: var(--color-text-muted);">No needs identified yet. Collect more survey responses.</div>`;
                return;
            }
            
            // Deduplicate by type + source
            const uniqueNeeds = [];
            const seen = new Set();
            needs.forEach(n => {
                const key = `${n.type}-${n.source}`;
                if (!seen.has(key)) {
                    seen.add(key);
                    uniqueNeeds.push(n);
                }
            });
            
            container.innerHTML = uniqueNeeds.map(need => `
                <div class="need-item" data-type="${need.type}">
                    <div>${need.text}</div>
                    <div class="need-source">From: ${escapeHtml(need.source)}</div>
                </div>
            `).join('');
        }
        
        function loadSponsorServices() {
            const sponsors = getSponsors().filter(s => s.status === 'active');
            const container = document.getElementById('sponsor-services-list');
            
            if (sponsors.length === 0) {
                container.innerHTML = `<div style="text-align: center; padding: var(--space-md); color: var(--color-text-muted);">No active sponsors yet.</div>`;
                return;
            }
            
            const services = [];
            sponsors.forEach(s => {
                s.categories.forEach(cat => {
                    services.push({
                        type: cat,
                        company: s.company,
                        description: s.services,
                        sponsorId: s.id
                    });
                });
            });
            
            const categoryLabels = {
                'real-estate': ' Real Estate',
                'mortgage': ' Mortgage',
                'financial': ' Financial',
                'insurance': ' Insurance',
                'legal': ' Legal',
                'moving': ' Moving',
                'tax': ' Tax',
                'career': ' Career',
                'wellness': ' Wellness',
                'other': ' Other'
            };
            
            container.innerHTML = services.map(svc => `
                <div class="service-item" data-type="${svc.type}">
                    <div>${categoryLabels[svc.type] || svc.type}</div>
                    <div class="service-source">${escapeHtml(svc.company)}</div>
                </div>
            `).join('');
        }
        
        function generateMatchSuggestions() {
            const responses = JSON.parse(localStorage.getItem('reach_responses') || '[]');
            const sponsors = getSponsors().filter(s => s.status === 'active');
            const container = document.getElementById('match-suggestions');
            
            // Map need types to sponsor categories
            const needToCategory = {
                'relocation': ['real-estate', 'moving', 'mortgage'],
                'mentorship': ['career'],
                'funding': ['financial'],
                'wellness': ['wellness'],
                'legal': ['legal'],
                'financial': ['financial', 'tax']
            };
            
            const matches = [];
            
            // Simple matching logic
            responses.forEach(r => {
                if (!r.answers) return;
                
                Object.values(r.answers).forEach(answer => {
                    if (typeof answer !== 'string') return;
                    const lowerAnswer = answer.toLowerCase();
                    
                    Object.entries(needToCategory).forEach(([needType, categories]) => {
                        let needDetected = false;
                        
                        if (needType === 'relocation' && (lowerAnswer.includes('relocat') || lowerAnswer.includes('moving'))) needDetected = true;
                        if (needType === 'wellness' && (lowerAnswer.includes('burnout') || lowerAnswer.includes('stress'))) needDetected = true;
                        if (needType === 'legal' && lowerAnswer.includes('contract')) needDetected = true;
                        if (needType === 'financial' && (lowerAnswer.includes('loan') || lowerAnswer.includes('debt'))) needDetected = true;
                        
                        if (needDetected) {
                            sponsors.forEach(sponsor => {
                                const hasMatchingCategory = sponsor.categories.some(c => categories.includes(c));
                                if (hasMatchingCategory) {
                                    matches.push({
                                        trainee: r.name,
                                        need: needType,
                                        sponsor: sponsor.company,
                                        sponsorId: sponsor.id
                                    });
                                }
                            });
                        }
                    });
                });
            });
            
            // Deduplicate
            const uniqueMatches = [];
            const seen = new Set();
            matches.forEach(m => {
                const key = `${m.trainee}-${m.need}-${m.sponsor}`;
                if (!seen.has(key)) {
                    seen.add(key);
                    uniqueMatches.push(m);
                }
            });
            
            if (uniqueMatches.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: var(--space-xl); color: var(--color-text-muted);">
                        <p>No matches found yet.</p>
                        <p style="font-size: 0.9rem;">Add more survey responses and sponsors to generate matches.</p>
                    </div>
                `;
                return;
            }
            
            const needLabels = {
                'relocation': 'Relocation Help',
                'mentorship': 'Career Guidance',
                'funding': 'Funding Support',
                'wellness': 'Wellness Support',
                'legal': 'Legal Help',
                'financial': 'Financial Planning'
            };
            
            container.innerHTML = uniqueMatches.slice(0, 12).map(match => `
                <div class="match-card">
                    <div class="match-card-header">
                        <span></span>
                        <span>Potential Match</span>
                    </div>
                    <div class="match-need">
                        <strong>Need:</strong> ${escapeHtml(match.trainee)} needs ${needLabels[match.need] || match.need}
                    </div>
                    <div class="match-sponsor">
                        <strong>Sponsor:</strong> ${escapeHtml(match.sponsor)} can help
                    </div>
                    <div class="match-actions">
                        <button class="btn btn--secondary" onclick="viewSponsor(${match.sponsorId})">View Sponsor</button>
                        <button class="btn btn--primary" onclick="createConnection('${escapeHtml(match.trainee)}', ${match.sponsorId})">Connect</button>
                    </div>
                </div>
            `).join('');
        }
        
        function createConnection(traineeName, sponsorId) {
            alert(`Connection feature coming soon!\n\nThis would:\n1. Notify ${traineeName} about the sponsor\n2. Notify the sponsor about the potential client\n3. Track the referral`);
        }
        
        // Initialize sponsor count
        updateSponsorCount();
        
        // ============================================
        // MARKETING NEEDS DISCOVERY
        // ============================================
        
        function getSponsorNeeds() {
            return JSON.parse(localStorage.getItem('reach_sponsor_needs') || '[]');
        }
        
        function saveSponsorNeeds(needs) {
            localStorage.setItem('reach_sponsor_needs', JSON.stringify(needs));
            updateSponsorNeedsCount();
        }
        
        function updateSponsorNeedsCount() {
            const needs = getSponsorNeeds();
            document.getElementById('sponsor-needs-count').textContent = needs.length;
        }
        
        function showNewNeedsForm() {
            document.getElementById('needs-form-container').style.display = 'block';
            document.getElementById('needs-company').focus();
        }
        
        function hideNeedsForm() {
            document.getElementById('needs-form-container').style.display = 'none';
            document.getElementById('sponsor-needs-form').reset();
        }
        
        function saveNeedsEntry(event) {
            event.preventDefault();
            
            const entry = {
                id: Date.now(),
                company: document.getElementById('needs-company').value,
                role: document.getElementById('needs-role').value || '',
                date: document.getElementById('needs-date').value || new Date().toISOString().split('T')[0],
                goals: document.getElementById('needs-goals').value || '',
                pains: document.getElementById('needs-pains').value || '',
                value: document.getElementById('needs-value').value || '',
                objections: document.getElementById('needs-objections').value || '',
                current: document.getElementById('needs-current').value || '',
                budget: document.getElementById('needs-budget').value || '',
                features: document.getElementById('needs-features').value || '',
                quotes: document.getElementById('needs-quotes').value || '',
                takeaways: document.getElementById('needs-takeaways').value || '',
                next: document.getElementById('needs-next').value || '',
                tags: document.getElementById('needs-tags').value.split(',').map(t => t.trim()).filter(t => t),
                createdAt: new Date().toISOString()
            };
            
            const needs = getSponsorNeeds();
            needs.unshift(entry);
            saveSponsorNeeds(needs);
            
            hideNeedsForm();
            loadSponsorNeedsView();
        }
        
        function loadSponsorNeedsView() {
            loadNeedsEntries();
            loadNeedsInsights();
        }
        
        function loadNeedsEntries() {
            const needs = getSponsorNeeds();
            const container = document.getElementById('needs-entries-list');
            
            if (needs.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: var(--space-xl); color: var(--color-text-muted);">
                        <div style="font-size: 2rem; margin-bottom: var(--space-sm);"></div>
                        <p>No discovery entries yet.</p>
                        <p style="font-size: 0.9rem; margin-top: var(--space-xs);">Start capturing insights from sponsor conversations.</p>
                        <button class="btn btn--primary" onclick="showNewNeedsForm()" style="margin-top: var(--space-md);">Add First Entry</button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = needs.map(entry => {
                const date = new Date(entry.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                
                return `
                    <div class="needs-entry">
                        <div class="needs-entry-header">
                            <div>
                                <div class="needs-entry-title">${escapeHtml(entry.company)}</div>
                                <div class="needs-entry-meta">${entry.role ? escapeHtml(entry.role) + '  ' : ''}${date}</div>
                            </div>
                        </div>
                        ${entry.tags.length > 0 ? `
                            <div class="needs-entry-tags">
                                ${entry.tags.map(t => `<span class="needs-tag">${escapeHtml(t)}</span>`).join('')}
                            </div>
                        ` : ''}
                        <div class="needs-entry-preview">
                            ${entry.goals ? `
                                <div class="needs-preview-item">
                                    <div class="needs-preview-label"> Goals</div>
                                    <div class="needs-preview-text">${escapeHtml(entry.goals.substring(0, 100))}${entry.goals.length > 100 ? '...' : ''}</div>
                                </div>
                            ` : ''}
                            ${entry.pains ? `
                                <div class="needs-preview-item">
                                    <div class="needs-preview-label"> Pain Points</div>
                                    <div class="needs-preview-text">${escapeHtml(entry.pains.substring(0, 100))}${entry.pains.length > 100 ? '...' : ''}</div>
                                </div>
                            ` : ''}
                            ${entry.value ? `
                                <div class="needs-preview-item">
                                    <div class="needs-preview-label"> Would Pay For</div>
                                    <div class="needs-preview-text">${escapeHtml(entry.value.substring(0, 100))}${entry.value.length > 100 ? '...' : ''}</div>
                                </div>
                            ` : ''}
                            ${entry.takeaways ? `
                                <div class="needs-preview-item">
                                    <div class="needs-preview-label"> Takeaways</div>
                                    <div class="needs-preview-text">${escapeHtml(entry.takeaways.substring(0, 100))}${entry.takeaways.length > 100 ? '...' : ''}</div>
                                </div>
                            ` : ''}
                        </div>
                        <div class="needs-entry-actions">
                            <button class="btn btn--secondary" onclick="viewNeedsEntry(${entry.id})">View Full</button>
                            <button class="btn btn--secondary" onclick="deleteNeedsEntry(${entry.id})" style="color: var(--color-text-muted);">Delete</button>
                            ${entry.next ? `<span style="font-size: 0.8rem; color: var(--color-text-muted); margin-left: auto;"> ${escapeHtml(entry.next.substring(0, 40))}${entry.next.length > 40 ? '...' : ''}</span>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function viewNeedsEntry(id) {
            const needs = getSponsorNeeds();
            const entry = needs.find(n => n.id === id);
            if (!entry) return;
            
            const date = new Date(entry.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
            
            const sections = [
                { label: ' Goals', value: entry.goals },
                { label: ' Pain Points', value: entry.pains },
                { label: ' Would Pay For', value: entry.value },
                { label: ' Objections', value: entry.objections },
                { label: ' Current Marketing', value: entry.current },
                { label: ' Budget Signals', value: entry.budget },
                { label: ' Features Requested', value: entry.features },
                { label: ' Quotes', value: entry.quotes },
                { label: ' Takeaways', value: entry.takeaways },
                { label: ' Next Steps', value: entry.next }
            ].filter(s => s.value);
            
            document.getElementById('modal-title').textContent = entry.company;
            document.getElementById('modal-body').innerHTML = `
                <div class="needs-detail">
                    <div class="detail-meta" style="margin-bottom: var(--space-md); color: var(--color-text-muted);">
                        ${entry.role ? escapeHtml(entry.role) + '  ' : ''}${date}
                    </div>
                    ${entry.tags.length > 0 ? `
                        <div class="needs-entry-tags" style="margin-bottom: var(--space-md);">
                            ${entry.tags.map(t => `<span class="needs-tag">${escapeHtml(t)}</span>`).join('')}
                        </div>
                    ` : ''}
                    ${sections.map(s => `
                        <div class="detail-section" style="margin-bottom: var(--space-md);">
                            <h4 style="font-size: 0.9rem; margin-bottom: var(--space-xs);">${s.label}</h4>
                            <p style="color: var(--color-text-secondary); white-space: pre-wrap;">${escapeHtml(s.value)}</p>
                        </div>
                    `).join('')}
                </div>
            `;
            document.getElementById('response-modal').classList.remove('hidden');
        }
        
        function deleteNeedsEntry(id) {
            if (!confirm('Delete this entry?')) return;
            
            const needs = getSponsorNeeds();
            const filtered = needs.filter(n => n.id !== id);
            saveSponsorNeeds(filtered);
            loadSponsorNeedsView();
        }
        
        function loadNeedsInsights() {
            const needs = getSponsorNeeds();
            const container = document.getElementById('insights-content');
            
            if (needs.length < 2) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: var(--space-lg); color: var(--color-text-muted);">
                        <p>Add more entries to see patterns emerge.</p>
                    </div>
                `;
                return;
            }
            
            // Extract patterns
            const allGoals = needs.map(n => n.goals).filter(g => g).join(' ').toLowerCase();
            const allPains = needs.map(n => n.pains).filter(p => p).join(' ').toLowerCase();
            const allValue = needs.map(n => n.value).filter(v => v).join(' ').toLowerCase();
            const allObjections = needs.map(n => n.objections).filter(o => o).join(' ').toLowerCase();
            const allFeatures = needs.map(n => n.features).filter(f => f).join(' ').toLowerCase();
            
            // Count themes
            const themes = {
                goals: [],
                pains: [],
                value: [],
                objections: []
            };
            
            // Goal themes
            if (allGoals.includes('client') || allGoals.includes('customer') || allGoals.includes('lead')) themes.goals.push('Get more clients/leads');
            if (allGoals.includes('physician') || allGoals.includes('doctor') || allGoals.includes('trainee')) themes.goals.push('Access to physicians');
            if (allGoals.includes('brand') || allGoals.includes('awareness')) themes.goals.push('Brand awareness');
            if (allGoals.includes('trust') || allGoals.includes('credib')) themes.goals.push('Build credibility');
            if (allGoals.includes('relationship') || allGoals.includes('long-term')) themes.goals.push('Long-term relationships');
            
            // Pain themes
            if (allPains.includes('reach') || allPains.includes('access') || allPains.includes('find')) themes.pains.push('Hard to reach physicians');
            if (allPains.includes('trust') || allPains.includes('skeptic')) themes.pains.push('Physicians are skeptical');
            if (allPains.includes('time') || allPains.includes('busy')) themes.pains.push('Physicians too busy');
            if (allPains.includes('competit') || allPains.includes('crowded')) themes.pains.push('Competitive market');
            if (allPains.includes('roi') || allPains.includes('measure') || allPains.includes('track')) themes.pains.push('Hard to measure ROI');
            
            // Value themes
            if (allValue.includes('lead') || allValue.includes('referral')) themes.value.push('Qualified leads/referrals');
            if (allValue.includes('content') || allValue.includes('article')) themes.value.push('Content/articles');
            if (allValue.includes('event') || allValue.includes('workshop')) themes.value.push('Events/workshops');
            if (allValue.includes('email') || allValue.includes('newsletter')) themes.value.push('Email access');
            if (allValue.includes('data') || allValue.includes('insight')) themes.value.push('Market insights/data');
            
            // Objection themes
            if (allObjections.includes('cost') || allObjections.includes('price') || allObjections.includes('expensive')) themes.objections.push('Cost concerns');
            if (allObjections.includes('roi') || allObjections.includes('worth')) themes.objections.push('ROI uncertainty');
            if (allObjections.includes('time') || allObjections.includes('bandwidth')) themes.objections.push('Time/bandwidth');
            if (allObjections.includes('already') || allObjections.includes('current')) themes.objections.push('Already have solution');
            
            container.innerHTML = `
                <div class="insight-card">
                    <h4> What They Want <span class="insight-count">${themes.goals.length}</span></h4>
                    ${themes.goals.length > 0 ? `<ul>${themes.goals.map(g => `<li>${g}</li>`).join('')}</ul>` : '<p style="font-size: 0.85rem; color: var(--color-text-muted);">No patterns yet</p>'}
                </div>
                <div class="insight-card">
                    <h4> Their Pain Points <span class="insight-count">${themes.pains.length}</span></h4>
                    ${themes.pains.length > 0 ? `<ul>${themes.pains.map(p => `<li>${p}</li>`).join('')}</ul>` : '<p style="font-size: 0.85rem; color: var(--color-text-muted);">No patterns yet</p>'}
                </div>
                <div class="insight-card">
                    <h4> What They'd Pay For <span class="insight-count">${themes.value.length}</span></h4>
                    ${themes.value.length > 0 ? `<ul>${themes.value.map(v => `<li>${v}</li>`).join('')}</ul>` : '<p style="font-size: 0.85rem; color: var(--color-text-muted);">No patterns yet</p>'}
                </div>
                <div class="insight-card">
                    <h4> Common Objections <span class="insight-count">${themes.objections.length}</span></h4>
                    ${themes.objections.length > 0 ? `<ul>${themes.objections.map(o => `<li>${o}</li>`).join('')}</ul>` : '<p style="font-size: 0.85rem; color: var(--color-text-muted);">No patterns yet</p>'}
                </div>
            `;
        }
        
        // Initialize sponsor needs count
        updateSponsorNeedsCount();
        
        // ============================================
        // RELOCATION MANAGEMENT
        // ============================================
        
        function getRelocations() {
            return JSON.parse(localStorage.getItem('reach_relocations') || '[]');
        }
        
        function saveRelocations(relocations) {
            localStorage.setItem('reach_relocations', JSON.stringify(relocations));
            updateRelocationCount();
        }
        
        function updateRelocationCount() {
            const relocations = getRelocations();
            const activeCount = relocations.filter(r => !['closed', 'lost'].includes(r.status)).length;
            document.getElementById('relocation-count').textContent = activeCount;
        }
        
        function clearRelocationForm() {
            document.getElementById('relocation-form').reset();
        }
        
        function saveRelocation(event) {
            event.preventDefault();
            
            const services = Array.from(document.querySelectorAll('input[name="relo-services"]:checked')).map(c => c.value);
            const housingType = document.querySelector('input[name="relo-type"]:checked')?.value || '';
            
            const relocation = {
                id: Date.now(),
                name: document.getElementById('relo-name').value,
                email: document.getElementById('relo-email').value,
                phone: document.getElementById('relo-phone').value || '',
                role: document.getElementById('relo-role').value || '',
                currentInstitution: document.getElementById('relo-current-institution').value || '',
                from: document.getElementById('relo-from').value,
                to: document.getElementById('relo-to').value,
                moveDate: document.getElementById('relo-date').value || '',
                reason: document.getElementById('relo-reason').value || '',
                newInstitution: document.getElementById('relo-new-institution').value || '',
                housingType: housingType,
                budget: document.getElementById('relo-budget').value || '',
                preapproved: document.getElementById('relo-preapproved').value || '',
                preferences: document.getElementById('relo-preferences').value || '',
                urgency: document.getElementById('relo-urgency').value || '',
                services: services,
                source: document.getElementById('relo-source').value || '',
                notes: document.getElementById('relo-notes').value || '',
                status: 'new',
                agentName: '',
                agentEmail: '',
                agentPhone: '',
                estimatedValue: 0,
                actualValue: 0,
                referralFee: 0,
                closedDate: '',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                history: [{
                    date: new Date().toISOString(),
                    action: 'Request created',
                    notes: ''
                }]
            };
            
            // Estimate potential value based on budget
            const budgetEstimates = {
                'under-200k': 150000,
                '200k-400k': 300000,
                '400k-600k': 500000,
                '600k-800k': 700000,
                '800k-1m': 900000,
                'over-1m': 1200000
            };
            
            if (housingType === 'buy' && budgetEstimates[relocation.budget]) {
                relocation.estimatedValue = budgetEstimates[relocation.budget];
            }
            
            const relocations = getRelocations();
            relocations.unshift(relocation);
            saveRelocations(relocations);
            
            alert('Relocation request saved!');
            clearRelocationForm();
            
            // Navigate to relocations list
            navigateTo('relocations');
            loadRelocationsView();
        }
        
        let reloFilter = 'all';
        
        function loadRelocationsView() {
            const relocations = getRelocations();
            const container = document.getElementById('relocations-list');
            
            // Update pipeline stats
            const stats = {
                new: relocations.filter(r => r.status === 'new').length,
                contacted: relocations.filter(r => r.status === 'contacted').length,
                matched: relocations.filter(r => r.status === 'matched').length,
                active: relocations.filter(r => r.status === 'active').length,
                closed: relocations.filter(r => r.status === 'closed').length
            };
            
            document.getElementById('stat-new').querySelector('.pipeline-stat-value').textContent = stats.new;
            document.getElementById('stat-contacted').querySelector('.pipeline-stat-value').textContent = stats.contacted;
            document.getElementById('stat-matched').querySelector('.pipeline-stat-value').textContent = stats.matched;
            document.getElementById('stat-active').querySelector('.pipeline-stat-value').textContent = stats.active;
            document.getElementById('stat-closed').querySelector('.pipeline-stat-value').textContent = stats.closed;
            
            // Calculate revenue
            const potentialRevenue = relocations
                .filter(r => ['new', 'contacted', 'matched', 'active'].includes(r.status) && r.housingType === 'buy')
                .reduce((sum, r) => sum + (r.estimatedValue * 0.03 * 0.25), 0); // 3% commission, 25% referral
            
            const earnedRevenue = relocations
                .filter(r => r.status === 'closed')
                .reduce((sum, r) => sum + (r.referralFee || 0), 0);
            
            document.getElementById('revenue-potential').textContent = `$${Math.round(potentialRevenue).toLocaleString()}`;
            document.getElementById('revenue-earned').textContent = `$${Math.round(earnedRevenue).toLocaleString()}`;
            
            // Filter relocations
            let filtered = relocations;
            if (reloFilter !== 'all') {
                filtered = relocations.filter(r => r.status === reloFilter);
            }
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: var(--space-xl); color: var(--color-text-muted);">
                        <div style="font-size: 2rem; margin-bottom: var(--space-sm);"></div>
                        <p>${reloFilter === 'all' ? 'No relocation requests yet.' : `No ${reloFilter} relocations.`}</p>
                        <button class="btn btn--primary" onclick="navigateTo('relocation-intake')" style="margin-top: var(--space-md);">Add First Request</button>
                    </div>
                `;
                return;
            }
            
            const roleLabels = {
                'medical-student': 'Medical Student',
                'resident': 'Resident',
                'fellow': 'Fellow',
                'attending': 'Attending',
                'other': 'Healthcare Prof.'
            };
            
            const reasonLabels = {
                'residency-match': 'Residency Match',
                'fellowship': 'Fellowship',
                'attending-position': 'Attending Position',
                'spouse-job': 'Spouse Job',
                'personal': 'Personal',
                'other': 'Other'
            };
            
            container.innerHTML = filtered.map(relo => {
                const moveDate = relo.moveDate ? new Date(relo.moveDate).toLocaleDateString('en-US', { month: 'short', year: 'numeric' }) : 'TBD';
                const potentialFee = relo.housingType === 'buy' && relo.estimatedValue ? `$${Math.round(relo.estimatedValue * 0.03 * 0.25).toLocaleString()}` : '';
                
                return `
                    <div class="relocation-card relocation-card--${relo.status}">
                        <div class="relocation-header">
                            <div>
                                <div class="relocation-name">${escapeHtml(relo.name)}</div>
                                <div class="relocation-route">
                                    ${escapeHtml(relo.from)} <span class="relocation-route-arrow"></span> ${escapeHtml(relo.to)}
                                </div>
                            </div>
                            <span class="relocation-status relocation-status--${relo.status}">${relo.status}</span>
                        </div>
                        <div class="relocation-meta">
                            ${roleLabels[relo.role] || relo.role || 'Unknown role'}  ${reasonLabels[relo.reason] || relo.reason || 'Unknown reason'}  Move: ${moveDate}
                        </div>
                        <div class="relocation-details">
                            <div class="relocation-detail-item">
                                <span class="relocation-detail-label">Type</span>
                                <span>${relo.housingType === 'buy' ? ' Buying' : relo.housingType === 'rent' ? ' Renting' : ' Unsure'}</span>
                            </div>
                            <div class="relocation-detail-item">
                                <span class="relocation-detail-label">Budget</span>
                                <span>${relo.budget || ''}</span>
                            </div>
                            <div class="relocation-detail-item">
                                <span class="relocation-detail-label">Urgency</span>
                                <span>${relo.urgency || ''}</span>
                            </div>
                            <div class="relocation-detail-item">
                                <span class="relocation-detail-label">Potential Fee</span>
                                <span style="color: var(--color-teal); font-weight: 600;">${potentialFee}</span>
                            </div>
                        </div>
                        <div class="relocation-actions">
                            <button class="btn btn--secondary" onclick="viewRelocation(${relo.id})">View Details</button>
                            ${relo.status === 'new' ? `<button class="btn btn--primary" onclick="updateRelocationStatus(${relo.id}, 'contacted')">Mark Contacted</button>` : ''}
                            ${relo.status === 'contacted' ? `<button class="btn btn--primary" onclick="assignAgent(${relo.id})">Assign Agent</button>` : ''}
                            ${relo.status === 'matched' ? `<button class="btn btn--primary" onclick="updateRelocationStatus(${relo.id}, 'active')">Start Search</button>` : ''}
                            ${relo.status === 'active' ? `<button class="btn btn--primary" onclick="closeRelocation(${relo.id})">Close Deal</button>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function filterRelocations(filter) {
            reloFilter = filter;
            
            document.querySelectorAll('[data-relo-filter]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.reloFilter === filter);
            });
            
            loadRelocationsView();
        }
        
        function updateRelocationStatus(id, newStatus) {
            const relocations = getRelocations();
            const relo = relocations.find(r => r.id === id);
            if (relo) {
                relo.status = newStatus;
                relo.updatedAt = new Date().toISOString();
                relo.history.push({
                    date: new Date().toISOString(),
                    action: `Status changed to ${newStatus}`,
                    notes: ''
                });
                saveRelocations(relocations);
                loadRelocationsView();
            }
        }
        
        function assignAgent(id) {
            const agentName = prompt('Enter agent name:');
            if (!agentName) return;
            
            const agentEmail = prompt('Enter agent email:');
            const agentPhone = prompt('Enter agent phone (optional):');
            
            const relocations = getRelocations();
            const relo = relocations.find(r => r.id === id);
            if (relo) {
                relo.agentName = agentName;
                relo.agentEmail = agentEmail || '';
                relo.agentPhone = agentPhone || '';
                relo.status = 'matched';
                relo.updatedAt = new Date().toISOString();
                relo.history.push({
                    date: new Date().toISOString(),
                    action: `Agent assigned: ${agentName}`,
                    notes: agentEmail
                });
                saveRelocations(relocations);
                loadRelocationsView();
            }
        }
        
        function closeRelocation(id) {
            const actualValue = prompt('Enter actual sale/purchase price ($):');
            if (!actualValue) return;
            
            const value = parseFloat(actualValue.replace(/[^0-9.]/g, ''));
            if (isNaN(value)) {
                alert('Invalid price');
                return;
            }
            
            const referralFee = value * 0.03 * 0.25; // 3% commission, 25% referral fee
            
            if (!confirm(`Close this deal?\n\nSale Price: $${value.toLocaleString()}\nEstimated Referral Fee: $${Math.round(referralFee).toLocaleString()}`)) {
                return;
            }
            
            const relocations = getRelocations();
            const relo = relocations.find(r => r.id === id);
            if (relo) {
                relo.actualValue = value;
                relo.referralFee = referralFee;
                relo.status = 'closed';
                relo.history.push({
                    date: new Date().toISOString(),
                    action: 'Deal closed',
                    notes: `Sale: $${value.toLocaleString()}, Fee: $${Math.round(referralFee).toLocaleString()}`
                });
                saveRelocations(relocations);
                loadRelocationsView();
                
                alert('Deal closed!\n\nReferral fee: $' + Math.round(referralFee).toLocaleString() + '\n\nThis funds approximately ' + (Math.floor(referralFee / 11500 * 10) / 10) + ' fellowship awards!');
            }
        }
        
        function viewRelocation(id) {
            const relocations = getRelocations();
            const relo = relocations.find(r => r.id === id);
            if (!relo) return;
            
            const roleLabels = {
                'medical-student': 'Medical Student',
                'resident': 'Resident',
                'fellow': 'Fellow',
                'attending': 'Attending',
                'other': 'Healthcare Professional'
            };
            
            const reasonLabels = {
                'residency-match': 'Residency Match',
                'fellowship': 'Fellowship',
                'attending-position': 'Attending Position',
                'spouse-job': 'Spouse/Partner Job',
                'personal': 'Personal Reasons',
                'other': 'Other'
            };
            
            document.getElementById('modal-title').textContent = relo.name;
            document.getElementById('modal-body').innerHTML = `
                <div class="relo-detail">
                    <div class="detail-section">
                        <h4>Contact Information</h4>
                        <p><strong>Email:</strong> ${escapeHtml(relo.email)}</p>
                        ${relo.phone ? `<p><strong>Phone:</strong> ${escapeHtml(relo.phone)}</p>` : ''}
                        <p><strong>Role:</strong> ${roleLabels[relo.role] || relo.role || 'Not specified'}</p>
                        ${relo.currentInstitution ? `<p><strong>Current Institution:</strong> ${escapeHtml(relo.currentInstitution)}</p>` : ''}
                    </div>
                    
                    <div class="detail-section">
                        <h4>Move Details</h4>
                        <p><strong>Route:</strong> ${escapeHtml(relo.from)}  ${escapeHtml(relo.to)}</p>
                        ${relo.moveDate ? `<p><strong>Target Date:</strong> ${new Date(relo.moveDate).toLocaleDateString()}</p>` : ''}
                        <p><strong>Reason:</strong> ${reasonLabels[relo.reason] || relo.reason || 'Not specified'}</p>
                        ${relo.newInstitution ? `<p><strong>New Institution:</strong> ${escapeHtml(relo.newInstitution)}</p>` : ''}
                    </div>
                    
                    <div class="detail-section">
                        <h4>Housing</h4>
                        <p><strong>Type:</strong> ${relo.housingType === 'buy' ? 'Buying' : relo.housingType === 'rent' ? 'Renting' : 'Unsure'}</p>
                        <p><strong>Budget:</strong> ${relo.budget || 'Not specified'}</p>
                        ${relo.preapproved ? `<p><strong>Pre-approved:</strong> ${relo.preapproved}</p>` : ''}
                        ${relo.preferences ? `<p><strong>Preferences:</strong> ${escapeHtml(relo.preferences)}</p>` : ''}
                    </div>
                    
                    ${relo.agentName ? `
                    <div class="detail-section">
                        <h4>Assigned Agent</h4>
                        <p><strong>Name:</strong> ${escapeHtml(relo.agentName)}</p>
                        ${relo.agentEmail ? `<p><strong>Email:</strong> ${escapeHtml(relo.agentEmail)}</p>` : ''}
                        ${relo.agentPhone ? `<p><strong>Phone:</strong> ${escapeHtml(relo.agentPhone)}</p>` : ''}
                    </div>
                    ` : ''}
                    
                    <div class="detail-section">
                        <h4>Financial</h4>
                        <p><strong>Status:</strong> <span class="relocation-status relocation-status--${relo.status}">${relo.status}</span></p>
                        ${relo.estimatedValue ? `<p><strong>Estimated Value:</strong> $${relo.estimatedValue.toLocaleString()}</p>` : ''}
                        ${relo.actualValue ? `<p><strong>Actual Value:</strong> $${relo.actualValue.toLocaleString()}</p>` : ''}
                        ${relo.referralFee ? `<p><strong>Referral Fee:</strong> $${Math.round(relo.referralFee).toLocaleString()}</p>` : ''}
                    </div>
                    
                    <div class="detail-section">
                        <h4>History</h4>
                        ${relo.history.map(h => `
                            <p style="font-size: 0.85rem; margin-bottom: 0.5rem;">
                                <span style="color: var(--color-text-muted);">${new Date(h.date).toLocaleDateString()}</span>
                                 ${escapeHtml(h.action)}
                                ${h.notes ? `<br><span style="color: var(--color-text-secondary);">${escapeHtml(h.notes)}</span>` : ''}
                            </p>
                        `).join('')}
                    </div>
                </div>
            `;
            document.getElementById('response-modal').classList.remove('hidden');
        }
        
        // Initialize relocation count
        updateRelocationCount();
    </script>
</body>
</html>
